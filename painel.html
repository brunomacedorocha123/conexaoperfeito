<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Perfil - Conex√£o Perfeita Amor</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #ff6b8b;
            --primary-light: #ffb6c1;
            --secondary: #a78bfa;
            --accent: #67e8f9;
            --light: #fdf2f8;
            --dark: #4a044e;
            --text: #444;
            --text-light: #666;
            --white: #fff;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
            --error: #e53e3e;
            --success: #38a169;
        }

        body {
            background-color: var(--light);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            padding: 1rem 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo a {
            text-decoration: none;
            color: var(--white);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .logo-icon {
            font-size: 2rem;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--white);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .btn {
            padding: 0.5rem 1.5rem;
            border-radius: 30px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--white);
            color: var(--white);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            border: none;
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* Main Content */
        .main-content {
            padding: 2rem 0;
        }

        .profile-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: var(--white);
            border-radius: 15px;
            box-shadow: var(--shadow);
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            margin: 0 auto 1rem;
        }

        .profile-header h2 {
            font-size: 2rem;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .profile-badge {
            display: inline-block;
            background: var(--primary-light);
            color: var(--dark);
            padding: 0.25rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        /* Profile Sections */
        .profile-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 768px) {
            .profile-sections {
                grid-template-columns: 1fr;
            }
        }

        .profile-section {
            background: var(--white);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .section-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light);
        }

        .section-header h3 {
            font-size: 1.5rem;
            color: var(--dark);
        }

        .edit-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .edit-btn:hover {
            color: var(--secondary);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--light);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            background-color: var(--white);
        }

        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
        }

        .form-text {
            font-size: 0.875rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        .char-count {
            text-align: right;
            font-size: 0.875rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        .char-count.warning {
            color: var(--error);
        }

        /* Checkbox Group */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        .checkbox-item label {
            margin: 0;
            font-weight: normal;
        }

        /* Profile Info Display */
        .info-grid {
            display: grid;
            gap: 1rem;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: var(--light);
            border-radius: 10px;
        }

        .info-label {
            font-weight: 500;
            color: var(--dark);
        }

        .info-value {
            color: var(--text);
        }

        .info-value.empty {
            color: var(--text-light);
            font-style: italic;
        }

        /* Actions Section */
        .profile-actions {
            background: var(--white);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .action-card {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }

        .action-card:hover {
            background: var(--primary-light);
            transform: translateY(-3px);
        }

        .action-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        /* Alert Messages */
        .alert {
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .alert-success {
            background-color: #f0fff4;
            border: 1px solid #9ae6b4;
            color: #276749;
        }

        .alert-error {
            background-color: #fed7d7;
            border: 1px solid #feb2b2;
            color: #c53030;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--light);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Footer */
        footer {
            background-color: var(--dark);
            color: var(--white);
            padding: 3rem 0 1.5rem;
            margin-top: 3rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-column h3 {
            margin-bottom: 1.5rem;
            font-size: 1.2rem;
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column ul li {
            margin-bottom: 0.8rem;
        }

        .footer-column a {
            color: var(--light);
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-column a:hover {
            color: var(--primary-light);
        }

        .copyright {
            text-align: center;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        /* Hidden class for toggling */
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
       <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Conex√£o Perfeita</h3>
                    <p>Uma plataforma segura e discreta para conectar cora√ß√µes e construir relacionamentos genu√≠nos.</p>
                </div>
                <div class="footer-column">
                    <h3>Links R√°pidos</h3>
                    <ul>
                        <li><a href="index.html">P√°gina Inicial</a></li>
                        <li><a href="home.html">Home</a></li>
                        <li><a href="#depoimentos">Depoimentos</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Suporte</h3>
                    <ul>
                        <li><a href="#">Central de Ajuda</a></li>
                        <li><a href="#">Pol√≠tica de Privacidade</a></li>
                        <li><a href="#">Termos de Uso</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 Conex√£o Perfeita Amor. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- ================================================== -->
    <!-- NOVAS SE√á√ïES ADICIONADAS -->
    <!-- ================================================== -->

    <!-- Se√ß√£o: Identidade e Caracter√≠sticas -->
    <section class="profile-section">
        <div class="section-header">
            <h3>‚ôã Identidade e Caracter√≠sticas</h3>
            <button class="edit-btn" onclick="toggleEdit('identityInfo')">
                <span>‚úèÔ∏è</span> Editar
            </button>
        </div>

        <!-- Display Mode -->
        <div id="identityInfoDisplay">
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Signo</span>
                    <span class="info-value" id="displayZodiac">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Orienta√ß√£o Sexual</span>
                    <span class="info-value" id="displaySexualOrientation">N√£o informado</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Escolaridade</span>
                    <span class="info-value" id="displayEducation">N√£o informado</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Profiss√£o</span>
                    <span class="info-value" id="displayOccupation">N√£o informado</span>
                </div>
            </div>
        </div>

        <!-- Edit Mode -->
        <div id="identityInfoEdit" class="hidden">
            <form id="identityInfoForm">
                <div class="form-group">
                    <label for="sexualOrientation">Orienta√ß√£o Sexual</label>
                    <select id="sexualOrientation" class="form-control">
                        <option value="">Selecione...</option>
                        <option value="heterossexual">Heterossexual</option>
                        <option value="homossexual">Homossexual</option>
                        <option value="bissexual">Bissexual</option>
                        <option value="assexual">Assexual</option>
                        <option value="pansexual">Pansexual</option>
                        <option value="outro">Outro</option>
                        <option value="nao_informar">Prefiro n√£o informar</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="education">Escolaridade</label>
                    <select id="education" class="form-control">
                        <option value="">Selecione...</option>
                        <option value="ensino_fundamental">Ensino Fundamental</option>
                        <option value="ensino_medio">Ensino M√©dio</option>
                        <option value="tecnologo">Tecn√≥logo</option>
                        <option value="graduacao">Gradua√ß√£o</option>
                        <option value="pos_graduacao">P√≥s-gradua√ß√£o</option>
                        <option value="mestrado">Mestrado</option>
                        <option value="doutorado">Doutorado</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="occupation">Profiss√£o</label>
                    <input type="text" id="occupation" class="form-control" placeholder="Ex: Engenheiro, Professor, M√©dico...">
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Salvar Altera√ß√µes</button>
                    <button type="button" class="btn btn-secondary" onclick="toggleEdit('identityInfo')">Cancelar</button>
                </div>
            </form>
        </div>
    </section>

    <!-- Se√ß√£o: Estilo de Vida -->
    <section class="profile-section">
        <div class="section-header">
            <h3>üåø Estilo de Vida</h3>
            <button class="edit-btn" onclick="toggleEdit('lifestyleInfo')">
                <span>‚úèÔ∏è</span> Editar
            </button>
        </div>

        <!-- Display Mode -->
        <div id="lifestyleInfoDisplay">
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Fumante</span>
                    <span class="info-value" id="displaySmoking">N√£o informado</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Bebida Alco√≥lica</span>
                    <span class="info-value" id="displayDrinking">N√£o informado</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Atividade F√≠sica</span>
                    <span class="info-value" id="displayExercise">N√£o informado</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Animais de Estima√ß√£o</span>
                    <span class="info-value" id="displayPets">N√£o informado</span>
                </div>
            </div>
        </div>

        <!-- Edit Mode -->
        <div id="lifestyleInfoEdit" class="hidden">
            <form id="lifestyleInfoForm">
                <div class="form-group">
                    <label for="smoking">Fumante</label>
                    <select id="smoking" class="form-control">
                        <option value="">Selecione...</option>
                        <option value="nao">N√£o</option>
                        <option value="sim">Sim</option>
                        <option value="socialmente">Socialmente</option>
                        <option value="parei">Parei de fumar</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="drinking">Bebida Alco√≥lica</label>
                    <select id="drinking" class="form-control">
                        <option value="">Selecione...</option>
                        <option value="nao">N√£o bebo</option>
                        <option value="socialmente">Socialmente</option>
                        <option value="moderadamente">Moderadamente</option>
                        <option value="frequentemente">Frequentemente</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="exercise">Atividade F√≠sica</label>
                    <select id="exercise" class="form-control">
                        <option value="">Selecione...</option>
                        <option value="sedentario">Sedent√°rio</option>
                        <option value="leve">Leve (caminhadas)</option>
                        <option value="moderado">Moderado (1-3x/semana)</option>
                        <option value="ativo">Ativo (4+ vezes/semana)</option>
                        <option value="atleta">Atleta</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="hasPets">Tem animais de estima√ß√£o?</label>
                    <select id="hasPets" class="form-control" onchange="togglePetsDescription()">
                        <option value="">Selecione...</option>
                        <option value="sim">Sim</option>
                        <option value="nao">N√£o</option>
                    </select>
                </div>
                
                <div class="form-group" id="petsDescriptionGroup" style="display: none;">
                    <label for="petsDescription">Quais animais voc√™ tem?</label>
                    <input type="text" id="petsDescription" class="form-control" placeholder="Ex: 2 gatos, 1 cachorro, 1 p√°ssaro...">
                    <div class="form-text">Descreva brevemente seus animais de estima√ß√£o</div>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Salvar Altera√ß√µes</button>
                    <button type="button" class="btn btn-secondary" onclick="toggleEdit('lifestyleInfo')">Cancelar</button>
                </div>
            </form>
        </div>
    </section>

    <!-- Se√ß√£o: Caracter√≠sticas F√≠sicas (Opcional) -->
    <section class="profile-section">
        <div class="section-header">
            <h3>üí™ Caracter√≠sticas F√≠sicas</h3>
            <button class="edit-btn" onclick="toggleEdit('physicalInfo')">
                <span>‚úèÔ∏è</span> Editar
            </button>
        </div>

        <!-- Display Mode -->
        <div id="physicalInfoDisplay">
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Altura</span>
                    <span class="info-value" id="displayHeight">N√£o informado</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Tipo de Corpo</span>
                    <span class="info-value" id="displayBodyType">N√£o informado</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Cor dos Olhos</span>
                    <span class="info-value" id="displayEyeColor">N√£o informado</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Cor do Cabelo</span>
                    <span class="info-value" id="displayHairColor">N√£o informado</span>
                </div>
            </div>
        </div>

        <!-- Edit Mode -->
        <div id="physicalInfoEdit" class="hidden">
            <form id="physicalInfoForm">
                <div class="form-group">
                    <label for="height">Altura (cm)</label>
                    <input type="number" id="height" class="form-control" placeholder="Ex: 175" min="100" max="250">
                </div>
                
                <div class="form-group">
                    <label for="bodyType">Tipo de Corpo</label>
                    <select id="bodyType" class="form-control">
                        <option value="">Selecione...</option>
                        <option value="magro">Magro</option>
                        <option value="atl√©tico">Atl√©tico</option>
                        <option value="mediano">Mediano</option>
                        <option value="cheio">Cheio</option>
                        <option value="musculoso">Musculoso</option>
                        <option value="nao_informar">Prefiro n√£o informar</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="eyeColor">Cor dos Olhos</label>
                    <select id="eyeColor" class="form-control">
                        <option value="">Selecione...</option>
                        <option value="castanho">Castanho</option>
                        <option value="preto">Preto</option>
                        <option value="azul">Azul</option>
                        <option value="verde">Verde</option>
                        <option value="cinza">Cinza</option>
                        <option value="avel√£">Avel√£</option>
                        <option value="nao_informar">Prefiro n√£o informar</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="hairColor">Cor do Cabelo</label>
                    <select id="hairColor" class="form-control">
                        <option value="">Selecione...</option>
                        <option value="preto">Preto</option>
                        <option value="castanho">Castanho</option>
                        <option value="loiro">Loiro</option>
                        <option value="ruivo">Ruivo</option>
                        <option value="grisalho">Grisalho</option>
                        <option value="colorido">Colorido</option>
                        <option value="careca">Careca</option>
                        <option value="nao_informar">Prefiro n√£o informar</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Salvar Altera√ß√µes</button>
                    <button type="button" class="btn btn-secondary" onclick="toggleEdit('physicalInfo')">Cancelar</button>
                </div>
            </form>
        </div>
    </section>

    <!-- Se√ß√£o: Controles de Privacidade -->
    <section class="profile-section">
        <div class="section-header">
            <h3>üîí Controles de Privacidade</h3>
            <p>Escolha o que mostrar publicamente</p>
        </div>

        <div class="privacy-controls">
            <div class="privacy-item">
                <div class="privacy-info">
                    <strong>Idade</strong>
                    <span>Mostrar minha idade publicamente</span>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="privacyAge" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="privacy-item">
                <div class="privacy-info">
                    <strong>Localiza√ß√£o</strong>
                    <span>Mostrar minha cidade/estado</span>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="privacyLocation" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="privacy-item">
                <div class="privacy-info">
                    <strong>Ocupa√ß√£o</strong>
                    <span>Mostrar minha profiss√£o</span>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="privacyOccupation" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="privacy-item">
                <div class="privacy-info">
                    <strong>Estilo de Vida</strong>
                    <span>Mostrar h√°bitos (fumo, bebida, etc)</span>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="privacyLifestyle" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="form-group" style="margin-top: 1.5rem;">
            <button class="btn btn-primary" onclick="savePrivacySettings()">
                üíæ Salvar Configura√ß√µes de Privacidade
            </button>
        </div>
    </section>

    <!-- Profile Actions (j√° existente - manter no final) -->
    <section class="profile-actions">
        <h3>A√ß√µes do Perfil</h3>
        <div class="actions-grid">
            <a href="home.html" class="action-card">
                <div class="action-icon">üè†</div>
                <h4>Voltar para Home</h4>
                <p>Retornar √† p√°gina principal</p>
            </a>
            <a href="#" class="action-card" onclick="exportProfileData()">
                <div class="action-icon">üì•</div>
                <h4>Exportar Dados</h4>
                <p>Baixar suas informa√ß√µes</p>
            </a>
            <a href="#" class="action-card" onclick="deleteAccount()">
                <div class="action-icon">üóëÔ∏è</div>
                <h4>Excluir Conta</h4>
                <p>Remover permanentemente</p>
            </a>
        </div>
    </section>
</div>
</main>

<footer>
    <!-- Footer existente - manter igual -->
    <div class="container">
        <div class="footer-content">
            <div class="footer-column">
                <h3>Conex√£o Perfeita</h3>
                <p>Uma plataforma segura e discreta para conectar cora√ß√µes e construir relacionamentos genu√≠nos.</p>
            </div>
            <div class="footer-column">
                <h3>Links R√°pidos</h3>
                <ul>
                    <li><a href="index.html">P√°gina Inicial</a></li>
                    <li><a href="home.html">Home</a></li>
                    <li><a href="#depoimentos">Depoimentos</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Suporte</h3>
                <ul>
                    <li><a href="#">Central de Ajuda</a></li>
                    <li><a href="#">Pol√≠tica de Privacidade</a></li>
                    <li><a href="#">Termos de Uso</a></li>
                </ul>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2023 Conex√£o Perfeita Amor. Todos os direitos reservados.</p>
        </div>
    </div>
</footer>

  <script>
    // Configura√ß√£o do Supabase
    const SUPABASE_URL = 'https://gcukalndarlgydmgmmmt.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdjdWthbG5kYXJsZ3lkbWdtbW10Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2NzI1ODEsImV4cCI6MjA3NTI0ODU4MX0.S1Qt1UbmK-Jtq2dX7Aarf2rDLZhoLgEcSLkCrBfIhUU';
    
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Estado da aplica√ß√£o
    let currentUser = null;
    let userProfile = null;
    let userDetails = null;

    document.addEventListener('DOMContentLoaded', function() {
        checkAuth();
        setupEventListeners();
        setupDescriptionCounter();
    });

    // Verificar autentica√ß√£o
    async function checkAuth() {
        try {
            const { data: { user }, error } = await supabase.auth.getUser();
            
            if (error) throw error;
            
            if (!user) {
                window.location.href = 'login.html';
                return;
            }
            
            currentUser = user;
            await loadUserData();
            
        } catch (error) {
            console.error('Erro na autentica√ß√£o:', error);
            window.location.href = 'login.html';
        }
    }

    // ‚úÖ CARREGAR DADOS DO USU√ÅRIO - ATUALIZADO
    async function loadUserData() {
        try {
            console.log('üîÑ Carregando dados do usu√°rio...');
            
            // ‚úÖ PRIMEIRO: Buscar dados do Auth
            const { data: { user } } = await supabase.auth.getUser();
            
            // ‚úÖ SEGUNDO: Tentar buscar perfil da tabela profiles
            const { data: profile, error: profileError } = await supabase
                .from('profiles')
                .select('*')
                .eq('id', currentUser.id)
                .single();

            if (profileError) {
                console.log('‚ö†Ô∏è Perfil n√£o encontrado na tabela, criando perfil b√°sico...');
                await createBasicProfile();
                userProfile = await getProfileData();
            } else {
                userProfile = profile;
            }

            // ‚úÖ TERCEIRO: Buscar detalhes complementares (AGORA COM NOVOS CAMPOS)
            const { data: details, error: detailsError } = await supabase
                .from('user_details')
                .select('*')
                .eq('user_id', currentUser.id)
                .single();

            if (detailsError && detailsError.code !== 'PGRST116') {
                console.error('Erro ao buscar detalhes:', detailsError);
            }
            
            userDetails = details || {};

            console.log('‚úÖ Dados carregados:', { userProfile, userDetails });

            await updateProfileDisplay();
            updateProfileForms();
            updatePrivacySettings();

        } catch (error) {
            console.error('‚ùå Erro ao carregar dados do usu√°rio:', error);
            showAlert('errorAlert', 'Erro ao carregar dados do perfil.');
        }
    }

    // ‚úÖ CRIAR PERFIL B√ÅSICO SE N√ÉO EXISTIR
    async function createBasicProfile() {
        try {
            console.log('üîÑ Criando perfil b√°sico...');
            
            const { data: { user } } = await supabase.auth.getUser();
            
            const { error } = await supabase
                .from('profiles')
                .insert([
                    {
                        id: user.id,
                        nickname: user.user_metadata?.nickname || user.email.split('@')[0],
                        full_name: user.user_metadata?.full_name || '',
                        birth_date: user.user_metadata?.birth_date || null,
                        created_at: new Date().toISOString(),
                        updated_at: new Date().toISOString()
                    }
                ]);

            if (error) {
                console.error('‚ùå Erro ao criar perfil:', error);
                await createUserDetails();
                throw error;
            }

            console.log('‚úÖ Perfil b√°sico criado com sucesso');
            return true;
        } catch (error) {
            console.error('‚ùå Erro na cria√ß√£o do perfil:', error);
            return false;
        }
    }

    // ‚úÖ CRIAR USER_DETAILS SE N√ÉO EXISTIR
    async function createUserDetails() {
        try {
            const { error } = await supabase
                .from('user_details')
                .insert([
                    {
                        user_id: currentUser.id,
                        privacy_settings: {
                            show_age: true,
                            show_location: true,
                            show_interests: true,
                            show_looking_for: true,
                            show_description: true,
                            show_gender: true,
                            show_education: true,
                            show_occupation: true,
                            show_lifestyle: true
                        },
                        created_at: new Date().toISOString(),
                        updated_at: new Date().toISOString()
                    }
                ]);

            if (error && error.code !== '23505') {
                console.error('Erro ao criar user_details:', error);
            }
        } catch (error) {
            console.error('Erro na cria√ß√£o de user_details:', error);
        }
    }

    // ‚úÖ BUSCAR DADOS DO PERFIL
    async function getProfileData() {
        const { data: profile, error } = await supabase
            .from('profiles')
            .select('*')
            .eq('id', currentUser.id)
            .single();

        if (error) throw error;
        return profile;
    }

    // ‚úÖ ATUALIZAR DISPLAY DO PERFIL - ATUALIZADO COM NOVOS CAMPOS
    async function updateProfileDisplay() {
        try {
            // ‚úÖ BUSCAR NICKNAME DO AUTH
            const { data: { user } } = await supabase.auth.getUser();
            const nickname = user.user_metadata?.nickname || user.email.split('@')[0];
            
            // Header
            document.getElementById('userNickname').textContent = nickname;
            document.getElementById('userAvatar').textContent = nickname.charAt(0).toUpperCase();
            document.getElementById('profileAvatar').textContent = nickname.charAt(0).toUpperCase();
            document.getElementById('profileName').textContent = nickname;

            // Informa√ß√µes b√°sicas (j√° existentes)
            document.getElementById('displayFullName').textContent = userProfile?.full_name || user.user_metadata?.full_name || 'N√£o informado';
            document.getElementById('displayFullName').className = (userProfile?.full_name || user.user_metadata?.full_name) ? 'info-value' : 'info-value empty';
            
            document.getElementById('displayEmail').textContent = user.email;
            document.getElementById('displayBirthDate').textContent = userProfile?.birth_date ? 
                new Date(userProfile.birth_date).toLocaleDateString('pt-BR') : 'N√£o informada';
            document.getElementById('displayBirthDate').className = userProfile?.birth_date ? 'info-value' : 'info-value empty';
            
            document.getElementById('displayAge').textContent = userProfile?.birth_date ? 
                calculateAge(userProfile.birth_date) + ' anos' : '-';

            // Informa√ß√µes de contato (j√° existentes)
            document.getElementById('displayPhone').textContent = userDetails.phone || 'N√£o informado';
            document.getElementById('displayPhone').className = userDetails.phone ? 'info-value' : 'info-value empty';
            
            document.getElementById('displayAddress').textContent = userDetails.address || 'N√£o informado';
            document.getElementById('displayAddress').className = userDetails.address ? 'info-value' : 'info-value empty';

            // Prefer√™ncias (j√° existentes)
            document.getElementById('displayGender').textContent = formatGender(userDetails.gender) || 'N√£o informado';
            document.getElementById('displayGender').className = userDetails.gender ? 'info-value' : 'info-value empty';
            
            document.getElementById('displayInterests').textContent = userDetails.interests ? 
                userDetails.interests.join(', ') : 'N√£o informados';
            document.getElementById('displayInterests').className = userDetails.interests ? 'info-value' : 'info-value empty';
            
            document.getElementById('displayLookingFor').textContent = formatLookingFor(userDetails.looking_for) || 'N√£o informado';
            document.getElementById('displayLookingFor').className = userDetails.looking_for ? 'info-value' : 'info-value empty';

            // Descri√ß√£o (j√° existente)
            document.getElementById('displayDescription').textContent = userDetails.description || 'Nenhuma descri√ß√£o adicionada ainda.';
            document.getElementById('displayDescription').className = userDetails.description ? 'info-value' : 'info-value empty';

            // ‚úÖ NOVOS CAMPOS: Identidade e Caracter√≠sticas
            document.getElementById('displayZodiac').textContent = userProfile?.birth_date ? 
                calculateZodiac(userProfile.birth_date) : '-';
            document.getElementById('displayZodiac').className = userProfile?.birth_date ? 'info-value' : 'info-value empty';
            
            document.getElementById('displaySexualOrientation').textContent = formatSexualOrientation(userDetails.sexual_orientation) || 'N√£o informado';
            document.getElementById('displaySexualOrientation').className = userDetails.sexual_orientation ? 'info-value' : 'info-value empty';
            
            document.getElementById('displayEducation').textContent = formatEducation(userDetails.education) || 'N√£o informado';
            document.getElementById('displayEducation').className = userDetails.education ? 'info-value' : 'info-value empty';
            
            document.getElementById('displayOccupation').textContent = userDetails.occupation || 'N√£o informado';
            document.getElementById('displayOccupation').className = userDetails.occupation ? 'info-value' : 'info-value empty';

            // ‚úÖ NOVOS CAMPOS: Estilo de Vida
            document.getElementById('displaySmoking').textContent = formatSmoking(userDetails.smoking) || 'N√£o informado';
            document.getElementById('displaySmoking').className = userDetails.smoking ? 'info-value' : 'info-value empty';
            
            document.getElementById('displayDrinking').textContent = formatDrinking(userDetails.drinking) || 'N√£o informado';
            document.getElementById('displayDrinking').className = userDetails.drinking ? 'info-value' : 'info-value empty';
            
            document.getElementById('displayExercise').textContent = formatExercise(userDetails.exercise) || 'N√£o informado';
            document.getElementById('displayExercise').className = userDetails.exercise ? 'info-value' : 'info-value empty';
            
            // Animais de estima√ß√£o
            let petsDisplay = 'N√£o informado';
            if (userDetails.has_pets === true) {
                petsDisplay = userDetails.pets_description || 'Sim';
            } else if (userDetails.has_pets === false) {
                petsDisplay = 'N√£o';
            }
            document.getElementById('displayPets').textContent = petsDisplay;
            document.getElementById('displayPets').className = userDetails.has_pets !== undefined ? 'info-value' : 'info-value empty';

            // ‚úÖ NOVOS CAMPOS: Caracter√≠sticas F√≠sicas
            document.getElementById('displayHeight').textContent = userDetails.height ? 
                userDetails.height + ' cm' : 'N√£o informado';
            document.getElementById('displayHeight').className = userDetails.height ? 'info-value' : 'info-value empty';
            
            document.getElementById('displayBodyType').textContent = formatBodyType(userDetails.body_type) || 'N√£o informado';
            document.getElementById('displayBodyType').className = userDetails.body_type ? 'info-value' : 'info-value empty';
            
            document.getElementById('displayEyeColor').textContent = formatEyeColor(userDetails.eye_color) || 'N√£o informado';
            document.getElementById('displayEyeColor').className = userDetails.eye_color ? 'info-value' : 'info-value empty';
            
            document.getElementById('displayHairColor').textContent = formatHairColor(userDetails.hair_color) || 'N√£o informado';
            document.getElementById('displayHairColor').className = userDetails.hair_color ? 'info-value' : 'info-value empty';

            // Atualizar badge do perfil
            updateProfileBadge();

        } catch (error) {
            console.error('‚ùå Erro ao atualizar display:', error);
        }
    }

    // Atualizar formul√°rios com dados existentes - ATUALIZADO
    function updateProfileForms() {
        // Formul√°rio de informa√ß√µes b√°sicas (j√° existente)
        document.getElementById('fullName').value = userProfile?.full_name || '';
        document.getElementById('birthDate').value = userProfile?.birth_date || '';

        // Formul√°rio de contato (j√° existente)
        document.getElementById('phone').value = userDetails.phone || '';
        document.getElementById('address').value = userDetails.address || '';

        // Formul√°rio de prefer√™ncias (j√° existente)
        document.getElementById('gender').value = userDetails.gender || '';
        document.getElementById('lookingFor').value = userDetails.looking_for || '';
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.checked = (userDetails.interests || []).includes(checkbox.value);
        });

        // Descri√ß√£o (j√° existente)
        document.getElementById('description').value = userDetails.description || '';
        updateCharCount();

        // ‚úÖ NOVOS FORMUL√ÅRIOS: Identidade e Caracter√≠sticas
        document.getElementById('sexualOrientation').value = userDetails.sexual_orientation || '';
        document.getElementById('education').value = userDetails.education || '';
        document.getElementById('occupation').value = userDetails.occupation || '';

        // ‚úÖ NOVOS FORMUL√ÅRIOS: Estilo de Vida
        document.getElementById('smoking').value = userDetails.smoking || '';
        document.getElementById('drinking').value = userDetails.drinking || '';
        document.getElementById('exercise').value = userDetails.exercise || '';
        document.getElementById('hasPets').value = userDetails.has_pets !== undefined ? 
            (userDetails.has_pets ? 'sim' : 'nao') : '';
        document.getElementById('petsDescription').value = userDetails.pets_description || '';
        togglePetsDescription(); // Atualizar visibilidade do campo

        // ‚úÖ NOVOS FORMUL√ÅRIOS: Caracter√≠sticas F√≠sicas
        document.getElementById('height').value = userDetails.height || '';
        document.getElementById('bodyType').value = userDetails.body_type || '';
        document.getElementById('eyeColor').value = userDetails.eye_color || '';
        document.getElementById('hairColor').value = userDetails.hair_color || '';
    }

    // ‚úÖ ATUALIZAR CONFIGURA√á√ïES DE PRIVACIDADE
    function updatePrivacySettings() {
        const privacy = userDetails.privacy_settings || {};
        
        document.getElementById('privacyAge').checked = privacy.show_age !== false;
        document.getElementById('privacyLocation').checked = privacy.show_location !== false;
        document.getElementById('privacyOccupation').checked = privacy.show_occupation !== false;
        document.getElementById('privacyLifestyle').checked = privacy.show_lifestyle !== false;
    }

    // Configurar contador de caracteres
    function setupDescriptionCounter() {
        const description = document.getElementById('description');
        description.addEventListener('input', updateCharCount);
    }

    function updateCharCount() {
        const description = document.getElementById('description');
        const charCount = document.getElementById('charCount');
        const count = description.value.length;
        
        charCount.textContent = `${count}/100 caracteres`;
        charCount.className = count > 100 ? 'char-count warning' : 'char-count';
    }

    // ‚úÖ FUN√á√ïES DE FORMATA√á√ÉO PARA NOVOS CAMPOS
    function calculateZodiac(birthDate) {
        const date = new Date(birthDate);
        const day = date.getDate();
        const month = date.getMonth() + 1;
        
        if ((month == 1 && day <= 20) || (month == 12 && day >= 22)) return 'Capric√≥rnio ‚ôë';
        if ((month == 1 && day >= 21) || (month == 2 && day <= 18)) return 'Aqu√°rio ‚ôí';
        if ((month == 2 && day >= 19) || (month == 3 && day <= 20)) return 'Peixes ‚ôì';
        if ((month == 3 && day >= 21) || (month == 4 && day <= 20)) return '√Åries ‚ôà';
        if ((month == 4 && day >= 21) || (month == 5 && day <= 20)) return 'Touro ‚ôâ';
        if ((month == 5 && day >= 21) || (month == 6 && day <= 20)) return 'G√™meos ‚ôä';
        if ((month == 6 && day >= 21) || (month == 7 && day <= 22)) return 'C√¢ncer ‚ôã';
        if ((month == 7 && day >= 23) || (month == 8 && day <= 22)) return 'Le√£o ‚ôå';
        if ((month == 8 && day >= 23) || (month == 9 && day <= 22)) return 'Virgem ‚ôç';
        if ((month == 9 && day >= 23) || (month == 10 && day <= 22)) return 'Libra ‚ôé';
        if ((month == 10 && day >= 23) || (month == 11 && day <= 21)) return 'Escorpi√£o ‚ôè';
        return 'Sagit√°rio ‚ôê';
    }

    function formatSexualOrientation(orientation) {
        const orientations = {
            'heterossexual': 'Heterossexual',
            'homossexual': 'Homossexual',
            'bissexual': 'Bissexual',
            'assexual': 'Assexual',
            'pansexual': 'Pansexual',
            'outro': 'Outro',
            'nao_informar': 'Prefiro n√£o informar'
        };
        return orientations[orientation] || orientation;
    }

    function formatEducation(education) {
        const levels = {
            'ensino_fundamental': 'Ensino Fundamental',
            'ensino_medio': 'Ensino M√©dio',
            'tecnologo': 'Tecn√≥logo',
            'graduacao': 'Gradua√ß√£o',
            'pos_graduacao': 'P√≥s-gradua√ß√£o',
            'mestrado': 'Mestrado',
            'doutorado': 'Doutorado'
        };
        return levels[education] || education;
    }

    function formatSmoking(smoking) {
        const options = {
            'nao': 'N√£o',
            'sim': 'Sim',
            'socialmente': 'Socialmente',
            'parei': 'Parei de fumar'
        };
        return options[smoking] || smoking;
    }

    function formatDrinking(drinking) {
        const options = {
            'nao': 'N√£o bebo',
            'socialmente': 'Socialmente',
            'moderadamente': 'Moderadamente',
            'frequentemente': 'Frequentemente'
        };
        return options[drinking] || drinking;
    }

    function formatExercise(exercise) {
        const options = {
            'sedentario': 'Sedent√°rio',
            'leve': 'Leve (caminhadas)',
            'moderado': 'Moderado (1-3x/semana)',
            'ativo': 'Ativo (4+ vezes/semana)',
            'atleta': 'Atleta'
        };
        return options[exercise] || exercise;
    }

    function formatBodyType(bodyType) {
        const types = {
            'magro': 'Magro',
            'atl√©tico': 'Atl√©tico',
            'mediano': 'Mediano',
            'cheio': 'Cheio',
            'musculoso': 'Musculoso',
            'nao_informar': 'Prefiro n√£o informar'
        };
        return types[bodyType] || bodyType;
    }

    function formatEyeColor(color) {
        const colors = {
            'castanho': 'Castanho',
            'preto': 'Preto',
            'azul': 'Azul',
            'verde': 'Verde',
            'cinza': 'Cinza',
            'avel√£': 'Avel√£',
            'nao_informar': 'Prefiro n√£o informar'
        };
        return colors[color] || color;
    }

    function formatHairColor(color) {
        const colors = {
            'preto': 'Preto',
            'castanho': 'Castanho',
            'loiro': 'Loiro',
            'ruivo': 'Ruivo',
            'grisalho': 'Grisalho',
            'colorido': 'Colorido',
            'careca': 'Careca',
            'nao_informar': 'Prefiro n√£o informar'
        };
        return colors[color] || color;
    }

    // Fun√ß√µes auxiliares existentes
    function calculateAge(birthDate) {
        const today = new Date();
        const birth = new Date(birthDate);
        let age = today.getFullYear() - birth.getFullYear();
        const monthDiff = today.getMonth() - birth.getMonth();
        
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
            age--;
        }
        
        return age;
    }

    function formatGender(gender) {
        const genders = {
            'feminino': 'Feminino',
            'masculino': 'Masculino',
            'nao_informar': 'Prefiro n√£o informar'
        };
        return genders[gender] || gender;
    }

    function formatLookingFor(lookingFor) {
        const options = {
            'amizade': 'Amizade',
            'namoro': 'Namoro',
            'relacionamento_serio': 'Relacionamento S√©rio',
            'conversa': 'Apenas Conversa'
        };
        return options[lookingFor] || lookingFor;
    }

    function updateProfileBadge() {
        const badge = document.getElementById('profileBadge');
        const completedFields = calculateProfileCompletion();
        
        if (completedFields >= 80) {
            badge.textContent = 'Perfil Completo';
            badge.style.background = 'var(--success)';
            badge.style.color = 'white';
        } else if (completedFields >= 50) {
            badge.textContent = 'Perfil em Andamento';
            badge.style.background = 'var(--primary-light)';
        } else {
            badge.textContent = 'Perfil B√°sico';
            badge.style.background = '#e2e8f0';
        }
    }

    function calculateProfileCompletion() {
        let completed = 0;
        let total = 0;

        // Campos b√°sicos
        const basicFields = ['full_name', 'birth_date', 'phone', 'address', 'gender', 'looking_for', 'description'];
        basicFields.forEach(field => {
            total++;
            if (field === 'interests') {
                if (userDetails.interests && userDetails.interests.length > 0) completed++;
            } else if (userDetails[field] || userProfile[field]) completed++;
        });

        // Novos campos
        const newFields = ['sexual_orientation', 'education', 'occupation', 'smoking', 'drinking', 'exercise', 'has_pets'];
        newFields.forEach(field => {
            total++;
            if (userDetails[field] !== undefined && userDetails[field] !== null && userDetails[field] !== '') completed++;
        });

        return Math.round((completed / total) * 100);
    }

    // Toggle entre display e edit mode
    function toggleEdit(section) {
        const display = document.getElementById(section + 'Display');
        const edit = document.getElementById(section + 'Edit');
        
        if (display.classList.contains('hidden')) {
            display.classList.remove('hidden');
            edit.classList.add('hidden');
        } else {
            display.classList.add('hidden');
            edit.classList.remove('hidden');
        }
    }

    // ‚úÖ MOSTRAR/OCULTAR CAMPO DE DESCRI√á√ÉO DE PETS
    function togglePetsDescription() {
        const hasPets = document.getElementById('hasPets').value;
        const petsGroup = document.getElementById('petsDescriptionGroup');
        petsGroup.style.display = hasPets === 'sim' ? 'block' : 'none';
    }

    // Configurar event listeners - ATUALIZADO
    function setupEventListeners() {
        document.getElementById('logoutBtn').addEventListener('click', logout);
        
        // Form submissions existentes
        document.getElementById('basicInfoForm').addEventListener('submit', saveBasicInfo);
        document.getElementById('contactInfoForm').addEventListener('submit', saveContactInfo);
        document.getElementById('preferencesInfoForm').addEventListener('submit', savePreferencesInfo);
        document.getElementById('descriptionInfoForm').addEventListener('submit', saveDescriptionInfo);
        
        // ‚úÖ NOVOS FORMUL√ÅRIOS
        document.getElementById('identityInfoForm').addEventListener('submit', saveIdentityInfo);
        document.getElementById('lifestyleInfoForm').addEventListener('submit', saveLifestyleInfo);
        document.getElementById('physicalInfoForm').addEventListener('submit', savePhysicalInfo);
    }

    // ‚úÖ SALVAR INFORMA√á√ïES DE IDENTIDADE
    async function saveIdentityInfo(e) {
        e.preventDefault();
        
        try {
            const sexualOrientation = document.getElementById('sexualOrientation').value;
            const education = document.getElementById('education').value;
            const occupation = document.getElementById('occupation').value;

            const { error } = await supabase
                .from('user_details')
                .upsert({
                    user_id: currentUser.id,
                    sexual_orientation: sexualOrientation,
                    education: education,
                    occupation: occupation,
                    updated_at: new Date()
                }, {
                    onConflict: 'user_id'
                });

            if (error) throw error;

            await loadUserData();
            toggleEdit('identityInfo');
            showAlert('successAlert', 'Informa√ß√µes de identidade atualizadas com sucesso!');
            
        } catch (error) {
            console.error('‚ùå Erro ao salvar informa√ß√µes de identidade:', error);
            showAlert('errorAlert', 'Erro ao salvar informa√ß√µes: ' + error.message);
        }
    }

    // ‚úÖ SALVAR INFORMA√á√ïES DE ESTILO DE VIDA
    async function saveLifestyleInfo(e) {
        e.preventDefault();
        
        try {
            const smoking = document.getElementById('smoking').value;
            const drinking = document.getElementById('drinking').value;
            const exercise = document.getElementById('exercise').value;
            const hasPets = document.getElementById('hasPets').value;
            const petsDescription = document.getElementById('petsDescription').value;

            const lifestyleData = {
                user_id: currentUser.id,
                smoking: smoking,
                drinking: drinking,
                exercise: exercise,
                has_pets: hasPets === 'sim' ? true : (hasPets === 'nao' ? false : null),
                pets_description: hasPets === 'sim' ? petsDescription : null,
                updated_at: new Date()
            };

            const { error } = await supabase
                .from('user_details')
                .upsert(lifestyleData, {
                    onConflict: 'user_id'
                });

            if (error) throw error;

            await loadUserData();
            toggleEdit('lifestyleInfo');
            showAlert('successAlert', 'Informa√ß√µes de estilo de vida atualizadas com sucesso!');
            
        } catch (error) {
            console.error('‚ùå Erro ao salvar estilo de vida:', error);
            showAlert('errorAlert', 'Erro ao salvar informa√ß√µes: ' + error.message);
        }
    }

    // ‚úÖ SALVAR CARACTER√çSTICAS F√çSICAS
    async function savePhysicalInfo(e) {
        e.preventDefault();
        
        try {
            const height = document.getElementById('height').value;
            const bodyType = document.getElementById('bodyType').value;
            const eyeColor = document.getElementById('eyeColor').value;
            const hairColor = document.getElementById('hairColor').value;

            const physicalData = {
                user_id: currentUser.id,
                height: height ? parseInt(height) : null,
                body_type: bodyType,
                eye_color: eyeColor,
                hair_color: hairColor,
                updated_at: new Date()
            };

            const { error } = await supabase
                .from('user_details')
                .upsert(physicalData, {
                    onConflict: 'user_id'
                });

            if (error) throw error;

            await loadUserData();
            toggleEdit('physicalInfo');
            showAlert('successAlert', 'Caracter√≠sticas f√≠sicas atualizadas com sucesso!');
            
        } catch (error) {
            console.error('‚ùå Erro ao salvar caracter√≠sticas f√≠sicas:', error);
            showAlert('errorAlert', 'Erro ao salvar informa√ß√µes: ' + error.message);
        }
    }

    // ‚úÖ SALVAR CONFIGURA√á√ïES DE PRIVACIDADE
    async function savePrivacySettings() {
        try {
            const privacySettings = {
                show_age: document.getElementById('privacyAge').checked,
                show_location: document.getElementById('privacyLocation').checked,
                show_occupation: document.getElementById('privacyOccupation').checked,
                show_lifestyle: document.getElementById('privacyLifestyle').checked
            };

            const { error } = await supabase
                .from('user_details')
                .upsert({
                    user_id: currentUser.id,
                    privacy_settings: privacySettings,
                    updated_at: new Date()
                }, {
                    onConflict: 'user_id'
                });

            if (error) throw error;

            showAlert('successAlert', 'Configura√ß√µes de privacidade salvas com sucesso!');
            
        } catch (error) {
            console.error('‚ùå Erro ao salvar privacidade:', error);
            showAlert('errorAlert', 'Erro ao salvar configura√ß√µes: ' + error.message);
        }
    }

    // Fun√ß√µes existentes de salvamento (manter iguais)
    async function saveBasicInfo(e) {
        e.preventDefault();
        
        try {
            const fullName = document.getElementById('fullName').value;
            const birthDate = document.getElementById('birthDate').value;

            const { data: existingProfile } = await supabase
                .from('profiles')
                .select('id')
                .eq('id', currentUser.id)
                .single();

            let error;
            
            if (existingProfile) {
                const { error: updateError } = await supabase
                    .from('profiles')
                    .update({
                        full_name: fullName,
                        birth_date: birthDate,
                        updated_at: new Date()
                    })
                    .eq('id', currentUser.id);

                error = updateError;
            } else {
                const { data: { user } } = await supabase.auth.getUser();
                const { error: insertError } = await supabase
                    .from('profiles')
                    .insert([
                        {
                            id: currentUser.id,
                            nickname: user.user_metadata?.nickname || user.email.split('@')[0],
                            full_name: fullName,
                            birth_date: birthDate,
                            created_at: new Date().toISOString(),
                            updated_at: new Date().toISOString()
                        }
                    ]);

                error = insertError;
            }

            if (error) throw error;

            await loadUserData();
            toggleEdit('basicInfo');
            showAlert('successAlert', 'Informa√ß√µes b√°sicas atualizadas com sucesso!');
            
        } catch (error) {
            console.error('‚ùå Erro ao salvar informa√ß√µes b√°sicas:', error);
            showAlert('errorAlert', 'Erro ao salvar informa√ß√µes b√°sicas: ' + error.message);
        }
    }

    async function saveContactInfo(e) {
        e.preventDefault();
        
        try {
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;

            const { error } = await supabase
                .from('user_details')
                .upsert({
                    user_id: currentUser.id,
                    phone: phone,
                    address: address,
                    updated_at: new Date()
                }, {
                    onConflict: 'user_id'
                });

            if (error) throw error;

            await loadUserData();
            toggleEdit('contactInfo');
            showAlert('successAlert', 'Informa√ß√µes de contato atualizadas com sucesso!');
            
        } catch (error) {
            console.error('‚ùå Erro ao salvar informa√ß√µes de contato:', error);
            showAlert('errorAlert', 'Erro ao salvar informa√ß√µes de contato: ' + error.message);
        }
    }

    async function savePreferencesInfo(e) {
        e.preventDefault();
        
        try {
            const gender = document.getElementById('gender').value;
            const lookingFor = document.getElementById('lookingFor').value;
            
            const interests = [];
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                interests.push(checkbox.value);
            });

            const { error } = await supabase
                .from('user_details')
                .upsert({
                    user_id: currentUser.id,
                    gender: gender,
                    interests: interests,
                    looking_for: lookingFor,
                    updated_at: new Date()
                }, {
                    onConflict: 'user_id'
                });

            if (error) throw error;

            await loadUserData();
            toggleEdit('preferencesInfo');
            showAlert('successAlert', 'Prefer√™ncias atualizadas com sucesso!');
            
        } catch (error) {
            console.error('‚ùå Erro ao salvar prefer√™ncias:', error);
            showAlert('errorAlert', 'Erro ao salvar prefer√™ncias: ' + error.message);
        }
    }

    async function saveDescriptionInfo(e) {
        e.preventDefault();
        
        try {
            const description = document.getElementById('description').value;
            
            if (description.length > 100) {
                showAlert('errorAlert', 'A descri√ß√£o deve ter no m√°ximo 100 caracteres.');
                return;
            }

            const { error } = await supabase
                .from('user_details')
                .upsert({
                    user_id: currentUser.id,
                    description: description,
                    updated_at: new Date()
                }, {
                    onConflict: 'user_id'
                });

            if (error) throw error;

            await loadUserData();
            toggleEdit('descriptionInfo');
            showAlert('successAlert', 'Descri√ß√£o atualizada com sucesso!');
            
        } catch (error) {
            console.error('‚ùå Erro ao salvar descri√ß√£o:', error);
            showAlert('errorAlert', 'Erro ao salvar descri√ß√£o: ' + error.message);
        }
    }

    // Logout
    async function logout() {
        try {
            const { error } = await supabase.auth.signOut();
            if (error) throw error;
            
            window.location.href = 'index.html';
        } catch (error) {
            console.error('Erro ao fazer logout:', error);
            showAlert('errorAlert', 'Erro ao fazer logout. Tente novamente.');
        }
    }

    // Fun√ß√µes auxiliares de alerta
    function showAlert(alertId, message) {
        const alert = document.getElementById(alertId);
        alert.textContent = message;
        alert.style.display = 'block';
        
        setTimeout(() => {
            alert.style.display = 'none';
        }, 5000);
    }

    // Fun√ß√µes de a√ß√£o
    function exportProfileData() {
        const profileData = {
            perfil: userProfile,
            detalhes: userDetails,
            exportado_em: new Date().toISOString()
        };
        
        const dataStr = JSON.stringify(profileData, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `perfil-${userProfile?.nickname || 'usuario'}-${new Date().getTime()}.json`;
        link.click();
        
        showAlert('successAlert', 'Dados exportados com sucesso!');
    }

    function deleteAccount() {
        if (confirm('Tem certeza que deseja excluir sua conta? Esta a√ß√£o n√£o pode ser desfeita e todos os seus dados ser√£o perdidos.')) {
            showAlert('errorAlert', 'Funcionalidade de exclus√£o de conta em desenvolvimento.');
        }
    }

    // ‚úÖ DEBUG: Verificar dados no console
    async function debugData() {
        console.log('üîç DEBUG - Dados atuais:');
        console.log('Current User:', currentUser);
        console.log('User Profile:', userProfile);
        console.log('User Details:', userDetails);
        
        const { data: profiles } = await supabase.from('profiles').select('*');
        const { data: userDetailsAll } = await supabase.from('user_details').select('*');
        
        console.log('Todos os perfis:', profiles);
        console.log('Todos os user_details:', userDetailsAll);
    }

    // Executar debug (pode remover depois)
    setTimeout(() => {
        debugData();
    }, 3000);
</script>
</body>
</html>