<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscar Pessoas - Amor Conect</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --bege: #f6ecc5;
            --vermelho-rosado: #d1656d;
            --lilas: #dfc9ed;
            --branco: #ffffff;
            --text: #444;
            --text-light: #666;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        body {
            background-color: var(--bege);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--vermelho-rosado), var(--lilas));
            color: var(--branco);
            padding: 0.5rem 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 80px;
        }

        /* Menu Hamburguer */
        #hamburgerBtn {
            display: none;
            background: none;
            border: none;
            color: var(--branco);
            font-size: 1.8rem;
            cursor: pointer;
            padding: 0.5rem;
            z-index: 1001;
            width: 40px;
            height: 40px;
            align-items: center;
            justify-content: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
            justify-content: center;
            flex: 1;
        }

        .logo img {
            height: 180px;
            width: auto;
            object-fit: contain;
        }

        .logo h1 {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--branco);
            white-space: nowrap;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Avatar no Header */
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--branco);
            color: var(--vermelho-rosado);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            background-size: cover;
            background-position: center;
            border: 2px solid var(--branco);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            flex-shrink: 0;
        }

        .user-avatar-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            display: none;
        }

        .user-avatar-fallback {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .btn {
            padding: 0.4rem 1.2rem;
            border-radius: 30px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-block;
            text-align: center;
            font-size: 0.85rem;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--branco);
            color: var(--branco);
        }

        .btn-primary {
            background: var(--branco);
            color: var(--vermelho-rosado);
            border: none;
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--vermelho-rosado);
            color: var(--vermelho-rosado);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* Menu Mobile */
        #mobileMenu {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, var(--vermelho-rosado), var(--lilas));
            z-index: 1000;
            padding: 2rem;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2rem;
        }

        #closeMobileMenu {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: none;
            border: none;
            color: var(--branco);
            font-size: 2.5rem;
            cursor: pointer;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mobile-user-info {
            text-align: center;
            color: var(--branco);
            margin-bottom: 2rem;
        }

        .mobile-nav {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
            max-width: 300px;
        }

        .mobile-nav .btn {
            width: 100%;
            text-align: center;
            justify-content: center;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 1.2rem;
            font-size: 1.2rem;
            border-radius: 12px;
        }

        /* Main Content */
        .main-content {
            padding: 2rem 0;
            min-height: 70vh;
        }

        /* Page Header */
        .page-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--branco);
            border-radius: 15px;
            box-shadow: var(--shadow);
            border: 1px solid var(--lilas);
        }

        .page-header h1 {
            font-size: 2rem;
            color: var(--vermelho-rosado);
            margin-bottom: 0.5rem;
        }

        .page-header p {
            color: var(--text-light);
            font-size: 1rem;
        }

        /* Filters Section */
        .filters-section {
            margin-bottom: 2rem;
        }

        .filters-card {
            background: var(--branco);
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: var(--shadow);
            border: 1px solid var(--lilas);
        }

        .filters-card h3 {
            font-size: 1.3rem;
            color: var(--vermelho-rosado);
            margin-bottom: 1.5rem;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-group label {
            font-weight: 600;
            color: var(--text);
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--lilas);
            border-radius: 10px;
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--bege);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--vermelho-rosado);
            background-color: var(--branco);
        }

        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
        }

        select.form-control[multiple] {
            background-image: none;
            height: auto;
            min-height: 120px;
            padding: 0.5rem;
        }

        select.form-control[multiple] option {
            padding: 0.5rem;
            border-radius: 5px;
            margin: 2px 0;
        }

        select.form-control[multiple] option:hover {
            background-color: var(--lilas);
        }

        select.form-control[multiple] option:checked {
            background-color: var(--vermelho-rosado);
            color: white;
        }

        .range-inputs {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .range-inputs input {
            flex: 1;
            text-align: center;
        }

        .range-inputs span {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .filter-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Results Section */
        .results-section {
            background: var(--branco);
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: var(--shadow);
            border: 1px solid var(--lilas);
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--bege);
        }

        .results-header h2 {
            font-size: 1.5rem;
            color: var(--vermelho-rosado);
            margin: 0;
        }

        .results-info {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        /* Users Grid */
        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .user-card {
            background: var(--bege);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .user-card:hover {
            transform: translateY(-5px);
            border-color: var(--lilas);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        /* Avatar nas Cards */
        .user-card-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--vermelho-rosado), var(--lilas));
            color: var(--branco);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
            margin: 0 auto 1rem;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border: 3px solid var(--branco);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        .user-card-avatar-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            display: none;
        }

        .user-card-avatar-fallback {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .user-card-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 0.5rem;
        }

        .user-card-info {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
            margin-bottom: 1rem;
        }

        .user-card-detail {
            font-size: 0.9rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.3rem;
        }

        .user-card-interests {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .interest-tag {
            background: var(--lilas);
            color: var(--text);
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .user-card-bio {
            font-size: 0.9rem;
            color: var(--text);
            margin-bottom: 1.5rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 4.5rem;
            line-height: 1.4;
        }

        .user-card-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 3rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--bege);
            border-top: 4px solid var(--vermelho-rosado);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* No Results */
        .no-results {
            text-align: center;
            padding: 3rem 2rem;
        }

        .no-results.hidden {
            display: none;
        }

        .no-results-content {
            max-width: 400px;
            margin: 0 auto;
        }

        .no-results-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.7;
        }

        .no-results h3 {
            font-size: 1.3rem;
            color: var(--vermelho-rosado);
            margin-bottom: 1rem;
        }

        .no-results p {
            color: var(--text-light);
            line-height: 1.6;
            font-size: 0.9rem;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 2rem;
        }

        .pagination-btn {
            padding: 0.5rem 1rem;
            border: 2px solid var(--vermelho-rosado);
            background: var(--branco);
            color: var(--vermelho-rosado);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .pagination-btn:hover:not(:disabled) {
            background: var(--vermelho-rosado);
            color: var(--branco);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-info {
            color: var(--text-light);
            font-size: 0.9rem;
            margin: 0 1rem;
        }

        /* Footer */
        footer {
            background-color: var(--bege);
            color: var(--text);
            padding: 2rem 0 1rem;
            margin-top: 2rem;
            border-top: 1px solid var(--lilas);
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .footer-column h3 {
            margin-bottom: 1rem;
            font-size: 1.1rem;
            color: var(--vermelho-rosado);
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column ul li {
            margin-bottom: 0.5rem;
        }

        .footer-column a {
            color: var(--text);
            text-decoration: none;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .footer-column a:hover {
            color: var(--vermelho-rosado);
        }

        .copyright {
            text-align: center;
            padding-top: 1rem;
            border-top: 1px solid var(--lilas);
            font-size: 0.8rem;
            color: var(--text-light);
        }

        /* Responsividade */
        @media (max-width: 768px) {
            #hamburgerBtn {
                display: flex;
            }

            .user-menu {
                display: none;
            }

            .header-content {
                flex-direction: row;
                justify-content: space-between;
                height: 80px;
                padding: 0;
            }

            .logo {
                justify-content: center;
                flex: 1;
                margin: 0 auto;
            }

            .logo img {
                height: 150px !important;
            }

            .logo h1 {
                display: none;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .filter-actions {
                flex-direction: column;
            }

            .users-grid {
                grid-template-columns: 1fr;
            }

            .results-header {
                flex-direction: column;
                gap: 0.5rem;
                align-items: flex-start;
            }

            .page-header h1 {
                font-size: 1.8rem;
            }

            .user-avatar {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }

            .user-card-avatar {
                width: 70px;
                height: 70px;
                font-size: 1.6rem;
            }

            .mobile-user-info .user-avatar {
                width: 100px;
                height: 100px;
                font-size: 2rem;
                margin: 0 auto 1rem;
            }

            .mobile-user-info #mobileUserNickname {
                font-size: 1.4rem;
                font-weight: bold;
            }
        }

        @media (max-width: 480px) {
            .user-card-actions {
                flex-direction: column;
            }

            .logo img {
                height: 130px !important;
            }

            .user-avatar {
                width: 35px;
                height: 35px;
                font-size: 0.9rem;
            }

            .header-content {
                height: 70px;
            }

            .page-header h1 {
                font-size: 1.5rem;
            }

            .filters-card h3 {
                font-size: 1.2rem;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <button id="hamburgerBtn">☰</button>
                <div class="logo">
                    <img src="logoamorconect.png" alt="Amor Conect">
                    <h1>Amor Conect</h1>
                </div>
                <div class="user-menu">
                    <div class="user-info">
                        <div class="user-avatar" id="userAvatar">
                            <img class="user-avatar-img" src="" alt="Avatar">
                            <div class="user-avatar-fallback">U</div>
                        </div>
                        <span id="userNickname">Usuário</span>
                    </div>
                    <a href="mensagens.html" class="btn btn-outline">💌 Mensagens</a>
                    <a href="home.html" class="btn btn-outline">🏠 Home</a>
                    <button class="btn btn-outline" id="logoutBtn">🚪 Sair</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Menu Mobile -->
    <div id="mobileMenu">
        <button id="closeMobileMenu">×</button>
        
        <div class="mobile-user-info">
            <div class="user-avatar" id="mobileUserAvatar">
                <img class="user-avatar-img" src="" alt="Avatar">
                <div class="user-avatar-fallback">U</div>
            </div>
            <div id="mobileUserNickname">Usuário</div>
        </div>

        <div class="mobile-nav">
            <a href="home.html" class="btn btn-outline">🏠 Home</a>
            <a href="mensagens.html" class="btn btn-outline">💌 Mensagens</a>
            <a href="painel.html" class="btn btn-outline">👤 Perfil</a>
            <a href="configuracoes.html" class="btn btn-outline">⚙️ Configurações</a>
            <button class="btn btn-outline" id="mobileLogoutBtn">🚪 Sair</button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Page Header -->
            <section class="page-header">
                <h1>🔍 Buscar Pessoas</h1>
                <p>Encontre pessoas incríveis com interesses similares aos seus</p>
            </section>

            <!-- Search Filters -->
            <section class="filters-section">
                <div class="filters-card">
                    <h3>Filtros de Busca</h3>
                    
                    <div class="filters-grid">
                        <!-- Idade -->
                        <div class="filter-group">
                            <label for="ageMin">Idade</label>
                            <div class="range-inputs">
                                <input type="number" id="ageMin" placeholder="18" min="18" max="100">
                                <span>até</span>
                                <input type="number" id="ageMax" placeholder="60" min="18" max="100">
                            </div>
                        </div>

                        <!-- Gênero -->
                        <div class="filter-group">
                            <label for="gender">Gênero</label>
                            <select id="gender" class="form-control">
                                <option value="">Todos</option>
                                <option value="feminino">Feminino</option>
                                <option value="masculino">Masculino</option>
                            </select>
                        </div>

                        <!-- Interesses -->
                        <div class="filter-group">
                            <label for="interests">Interesses</label>
                            <select id="interests" class="form-control" multiple>
                                <option value="nao_importa">💫 Não importa</option>
                                <option value="Cinema">🎬 Cinema</option>
                                <option value="Música">🎵 Música</option>
                                <option value="Esportes">⚽ Esportes</option>
                                <option value="Viagens">✈️ Viagens</option>
                                <option value="Leitura">📚 Leitura</option>
                                <option value="Culinária">🍳 Culinária</option>
                                <option value="Jogos">🎮 Jogos</option>
                                <option value="Arte">🎨 Arte</option>
                            </select>
                        </div>

                        <!-- Procura por -->
                        <div class="filter-group">
                            <label for="lookingFor">Procura por</label>
                            <select id="lookingFor" class="form-control">
                                <option value="">Todos</option>
                                <option value="amizade">🤝 Amizade</option>
                                <option value="namoro">💕 Namoro</option>
                                <option value="relacionamento_serio">💍 Relacionamento Sério</option>
                                <option value="conversa">💬 Apenas Conversa</option>
                            </select>
                        </div>

                        <!-- Localização -->
                        <div class="filter-group">
                            <label for="location">📍 Localização</label>
                            <input type="text" id="location" class="form-control" placeholder="Cidade ou Estado">
                        </div>

                        <!-- Signo -->
                        <div class="filter-group">
                            <label for="zodiac">⭐ Signo</label>
                            <select id="zodiac" class="form-control">
                                <option value="">Todos</option>
                                <option value="aries">♈ Áries</option>
                                <option value="touro">♉ Touro</option>
                                <option value="gemeos">♊ Gêmeos</option>
                                <option value="cancer">♋ Câncer</option>
                                <option value="leao">♌ Leão</option>
                                <option value="virgem">♍ Virgem</option>
                                <option value="libra">♎ Libra</option>
                                <option value="escorpiao">♏ Escorpião</option>
                                <option value="sagitario">♐ Sagitário</option>
                                <option value="capricornio">♑ Capricórnio</option>
                                <option value="aquario">♒ Aquário</option>
                                <option value="peixes">♓ Peixes</option>
                            </select>
                        </div>
                    </div>

                    <div class="filter-actions">
                        <button class="btn btn-primary" id="applyFiltersBtn">
                            🔍 Aplicar Filtros
                        </button>
                        <button class="btn btn-secondary" id="clearFiltersBtn">
                            🗑️ Limpar Filtros
                        </button>
                    </div>
                </div>
            </section>

            <!-- Results Section -->
            <section class="results-section">
                <div class="results-header">
                    <h2>Pessoas Encontradas</h2>
                    <div class="results-info">
                        <span id="resultsCount">Carregando...</span>
                    </div>
                </div>

                <!-- Loading State -->
                <div class="loading hidden" id="loadingResults">
                    <div class="spinner"></div>
                    <p>Buscando pessoas...</p>
                </div>

                <!-- Results Grid -->
                <div class="users-grid" id="usersGrid">
                    <!-- Os cards serão inseridos aqui via JavaScript -->
                </div>

                <!-- Pagination -->
                <div class="pagination hidden" id="pagination">
                    <!-- Paginação será inserida aqui -->
                </div>

                <!-- No Results -->
                <div class="no-results hidden" id="noResults">
                    <div class="no-results-content">
                        <div class="no-results-icon">🔍</div>
                        <h3>Nenhuma pessoa encontrada</h3>
                        <p>Tente ajustar os filtros de busca para encontrar mais pessoas.</p>
                        <button class="btn btn-primary" id="clearFiltersNoResults">
                            🗑️ Limpar Filtros
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Amor Conect</h3>
                    <p>Uma plataforma segura e discreta para conectar corações e construir relacionamentos genuínos.</p>
                </div>
                <div class="footer-column">
                    <h3>Links Rápidos</h3>
                    <ul>
                        <li><a href="index.html">Página Inicial</a></li>
                        <li><a href="home.html">Home</a></li>
                        <li><a href="mensagens.html">Mensagens</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Suporte</h3>
                    <ul>
                        <li><a href="#">Central de Ajuda</a></li>
                        <li><a href="#">Política de Privacidade</a></li>
                        <li><a href="#">Termos de Uso</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 Amor Conect. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

<script>
    // Configuração do Supabase
    const SUPABASE_URL = 'https://gcukalndarlgydmgmmmt.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdjdWthbG5kYXJsZ3lkbWdtbW10Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2NzI1ODEsImV4cCI6MjA3NTI0ODU4MX0.S1Qt1UbmK-Jtq2dX7Aarf2rDLZhoLgEcSLkCrBfIhUU';

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Estado da aplicação
    let currentUser = null;
    let currentPage = 1;
    const usersPerPage = 12;
    let totalUsers = 0;
    let currentFilters = {};

    document.addEventListener('DOMContentLoaded', function() {
        checkAuth();
        setupMobileMenu();
    });

    // ==================== MENU MOBILE ====================
    function setupMobileMenu() {
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const mobileMenu = document.getElementById('mobileMenu');
        const closeMobileMenu = document.getElementById('closeMobileMenu');
        const mobileLogoutBtn = document.getElementById('mobileLogoutBtn');

        if (!hamburgerBtn || !mobileMenu) {
            console.error('Elementos do menu mobile não encontrados');
            return;
        }

        hamburgerBtn.addEventListener('click', () => {
            mobileMenu.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        });

        closeMobileMenu.addEventListener('click', () => {
            mobileMenu.style.display = 'none';
            document.body.style.overflow = 'auto';
        });

        if (mobileLogoutBtn) {
            mobileLogoutBtn.addEventListener('click', logout);
        }

        // Fechar menu ao clicar em um link
        mobileMenu.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                mobileMenu.style.display = 'none';
                document.body.style.overflow = 'auto';
            });
        });

        // Verificar tamanho da tela
        function checkScreenSize() {
            if (window.innerWidth <= 768) {
                const userMenu = document.querySelector('.user-menu');
                if (userMenu) userMenu.style.display = 'none';
                if (hamburgerBtn) hamburgerBtn.style.display = 'flex';
            } else {
                const userMenu = document.querySelector('.user-menu');
                if (userMenu) userMenu.style.display = 'flex';
                if (hamburgerBtn) hamburgerBtn.style.display = 'none';
                if (mobileMenu) mobileMenu.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }

        window.addEventListener('resize', checkScreenSize);
        checkScreenSize();
    }

    // ==================== AUTENTICAÇÃO ====================
    async function checkAuth() {
        try {
            const { data: { user }, error } = await supabase.auth.getUser();
            
            if (error) throw error;
            
            if (!user) {
                window.location.href = 'login.html';
                return;
            }
            
            currentUser = user;
            await loadUserData();
            setupEventListeners();
            await loadInitialUsers();
            
        } catch (error) {
            console.error('Erro na autenticação:', error);
            window.location.href = 'login.html';
        }
    }

    // ==================== DADOS DO USUÁRIO ====================
    async function loadUserData() {
        try {
            const { data: { user } } = await supabase.auth.getUser();
            
            let displayName = 'Usuário';
            
            if (user.user_metadata && user.user_metadata.nickname) {
                displayName = user.user_metadata.nickname;
            } else if (user.user_metadata && user.user_metadata.full_name) {
                displayName = user.user_metadata.full_name;
            } else if (user.email) {
                displayName = user.email.split('@')[0];
            }

            // Atualizar nome em todos os lugares
            const userNickname = document.getElementById('userNickname');
            const mobileUserNickname = document.getElementById('mobileUserNickname');
            
            if (userNickname) userNickname.textContent = displayName;
            if (mobileUserNickname) mobileUserNickname.textContent = displayName;
            
            // Carregar foto do usuário logado
            await loadCurrentUserAvatar();

        } catch (error) {
            console.error('Erro ao carregar dados do usuário:', error);
        }
    }

    async function loadCurrentUserAvatar() {
        try {
            const { data: profile, error } = await supabase
                .from('profiles')
                .select('avatar_url, nickname')
                .eq('id', currentUser.id)
                .single();

            if (error || !profile) {
                console.log('Perfil não encontrado ou erro:', error);
                return;
            }

            const avatarElements = [
                document.getElementById('userAvatar'),
                document.getElementById('mobileUserAvatar')
            ];

            for (const avatarElement of avatarElements) {
                if (!avatarElement) continue;
                
                const userAvatarFallback = avatarElement.querySelector('.user-avatar-fallback');
                const userAvatarImg = avatarElement.querySelector('.user-avatar-img');
                
                if (!userAvatarFallback || !userAvatarImg) continue;

                // Iniciar com fallback visível
                userAvatarImg.style.display = 'none';
                userAvatarFallback.style.display = 'flex';
                
                if (profile.avatar_url) {
                    const photoUrl = await loadUserPhoto(profile.avatar_url);
                    if (photoUrl) {
                        userAvatarImg.src = photoUrl;
                        userAvatarImg.style.display = 'block';
                        userAvatarFallback.style.display = 'none';
                        avatarElement.style.backgroundImage = `url(${photoUrl})`;
                        avatarElement.style.backgroundSize = 'cover';
                        avatarElement.style.backgroundPosition = 'center';
                    } else {
                        // Mostrar inicial do nome
                        const displayName = profile.nickname || 'Usuário';
                        userAvatarFallback.textContent = displayName.charAt(0).toUpperCase();
                    }
                } else {
                    // Mostrar inicial do nome
                    const displayName = profile.nickname || 'Usuário';
                    userAvatarFallback.textContent = displayName.charAt(0).toUpperCase();
                }
            }

        } catch (error) {
            console.error('Erro ao carregar avatar do usuário:', error);
        }
    }

    // ✅ FUNÇÃO CORRIGIDA - getPublicUrl em vez de download
    async function loadUserPhoto(avatarUrl) {
        try {
            if (!avatarUrl) return null;

            console.log('🔄 Tentando carregar foto:', avatarUrl);
            
            // ✅ CORREÇÃO: Usar getPublicUrl em vez de download
            const { data } = supabase.storage
                .from('avatars')
                .getPublicUrl(avatarUrl);

            if (data && data.publicUrl) {
                console.log('✅ URL pública encontrada:', data.publicUrl);
                return data.publicUrl;
            } else {
                console.log('❌ Não foi possível obter URL pública');
                return null;
            }

        } catch (error) {
            console.error('❌ Erro ao carregar foto:', error);
            return null;
        }
    }

    // ==================== EVENT LISTENERS ====================
    function setupEventListeners() {
        // Logout
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', logout);
        }

        // Filtros
        const applyFiltersBtn = document.getElementById('applyFiltersBtn');
        const clearFiltersBtn = document.getElementById('clearFiltersBtn');
        const clearFiltersNoResults = document.getElementById('clearFiltersNoResults');

        if (applyFiltersBtn) applyFiltersBtn.addEventListener('click', applyFilters);
        if (clearFiltersBtn) clearFiltersBtn.addEventListener('click', clearFilters);
        if (clearFiltersNoResults) clearFiltersNoResults.addEventListener('click', clearFilters);

        // Buscar ao mudar filtros (opcional)
        const filterInputs = document.querySelectorAll('.form-control, .range-inputs input');
        filterInputs.forEach(input => {
            input.addEventListener('change', debounce(applyFilters, 500));
        });

        // Prevenir zoom em inputs no iOS
        document.addEventListener('touchstart', function() {}, { passive: true });
    }

    // Debounce para otimizar buscas
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    // ==================== LOGOUT ====================
    async function logout() {
        try {
            const { error } = await supabase.auth.signOut();
            if (error) throw error;
            window.location.href = 'login.html';
        } catch (error) {
            console.error('Erro ao fazer logout:', error);
            alert('Erro ao fazer logout. Tente novamente.');
        }
    }

    // ==================== SISTEMA DE BUSCA ====================
    async function loadInitialUsers() {
        await applyFilters();
    }

    async function applyFilters() {
        try {
            currentPage = 1;
            currentFilters = getCurrentFilters();
            
            showLoadingState();
            await searchUsers();
            
        } catch (error) {
            console.error('Erro ao aplicar filtros:', error);
            showError('Erro ao buscar usuários. Tente novamente.');
        }
    }

    function clearFilters() {
        // Limpar inputs
        const ageMin = document.getElementById('ageMin');
        const ageMax = document.getElementById('ageMax');
        const gender = document.getElementById('gender');
        const lookingFor = document.getElementById('lookingFor');
        const location = document.getElementById('location');
        const zodiac = document.getElementById('zodiac');
        
        if (ageMin) ageMin.value = '';
        if (ageMax) ageMax.value = '';
        if (gender) gender.value = '';
        if (lookingFor) lookingFor.value = '';
        if (location) location.value = '';
        if (zodiac) zodiac.value = '';
        
        // Limpar seleção múltipla de interesses
        const interestsSelect = document.getElementById('interests');
        if (interestsSelect) {
            for (let option of interestsSelect.options) {
                option.selected = false;
            }
        }
        
        applyFilters();
    }

    function getCurrentFilters() {
        const ageMin = document.getElementById('ageMin');
        const ageMax = document.getElementById('ageMax');
        const gender = document.getElementById('gender');
        const lookingFor = document.getElementById('lookingFor');
        const location = document.getElementById('location');
        const zodiac = document.getElementById('zodiac');
        
        // Obter interesses selecionados
        const interestsSelect = document.getElementById('interests');
        const selectedInterests = [];
        
        if (interestsSelect) {
            for (let option of interestsSelect.options) {
                if (option.selected) {
                    if (option.value === 'nao_importa') {
                        return {
                            ageMin: ageMin && ageMin.value ? parseInt(ageMin.value) : null,
                            ageMax: ageMax && ageMax.value ? parseInt(ageMax.value) : null,
                            gender: gender && gender.value ? gender.value : null,
                            lookingFor: lookingFor && lookingFor.value ? lookingFor.value : null,
                            location: location && location.value ? location.value : null,
                            zodiac: zodiac && zodiac.value ? zodiac.value : null,
                            interests: null
                        };
                    }
                    selectedInterests.push(option.value);
                }
            }
        }

        return {
            ageMin: ageMin && ageMin.value ? parseInt(ageMin.value) : null,
            ageMax: ageMax && ageMax.value ? parseInt(ageMax.value) : null,
            gender: gender && gender.value ? gender.value : null,
            lookingFor: lookingFor && lookingFor.value ? lookingFor.value : null,
            location: location && location.value ? location.value : null,
            zodiac: zodiac && zodiac.value ? zodiac.value : null,
            interests: selectedInterests.length > 0 ? selectedInterests : null
        };
    }

    async function searchUsers() {
        try {
            console.log('🔍 Aplicando filtros:', currentFilters);
            
            // Buscar com JOIN entre profiles e user_details
            let query = supabase
                .from('profiles')
                .select(`
                    *,
                    user_details (
                        gender,
                        looking_for,
                        interests,
                        zodiac,
                        address,
                        description,
                        profession
                    )
                `)
                .neq('id', currentUser.id)
                .not('birth_date', 'is', null);

            const { data: users, error } = await query;

            if (error) throw error;

            console.log('📊 Usuários encontrados:', users?.length);

            // Aplicar filtros no client-side
            let filteredUsers = users || [];
            
            // Filtro de idade
            if (currentFilters.ageMin || currentFilters.ageMax) {
                filteredUsers = filteredUsers.filter(user => {
                    if (!user.birth_date) return false;
                    
                    const age = calculateAge(user.birth_date);
                    const minAge = currentFilters.ageMin || 0;
                    const maxAge = currentFilters.ageMax || 100;
                    
                    return age >= minAge && age <= maxAge;
                });
            }

            // Filtro de gênero
            if (currentFilters.gender) {
                filteredUsers = filteredUsers.filter(user => 
                    user.user_details?.gender === currentFilters.gender
                );
            }

            // Filtro de localização
            if (currentFilters.location) {
                filteredUsers = filteredUsers.filter(user => 
                    user.user_details?.address && 
                    user.user_details.address.toLowerCase().includes(currentFilters.location.toLowerCase())
                );
            }

            // Filtro de signo
            if (currentFilters.zodiac) {
                filteredUsers = filteredUsers.filter(user => 
                    user.user_details?.zodiac === currentFilters.zodiac
                );
            }

            // Filtro de interesses
            if (currentFilters.interests && currentFilters.interests.length > 0) {
                filteredUsers = filteredUsers.filter(user => {
                    if (!user.user_details?.interests) return false;
                    return currentFilters.interests.some(interest => 
                        user.user_details.interests.includes(interest)
                    );
                });
            }

            // Filtro de looking_for
            if (currentFilters.lookingFor) {
                filteredUsers = filteredUsers.filter(user => 
                    user.user_details?.looking_for === currentFilters.lookingFor
                );
            }

            console.log('🎉 RESULTADO FINAL:', filteredUsers.length, 'usuários');

            // Paginação
            totalUsers = filteredUsers.length;
            const startIndex = (currentPage - 1) * usersPerPage;
            const endIndex = startIndex + usersPerPage;
            const paginatedUsers = filteredUsers.slice(startIndex, endIndex);

            await displayUsersWithPhotos(paginatedUsers);
            updatePagination();
            updateResultsCount(paginatedUsers.length, totalUsers);

        } catch (error) {
            console.error('❌ Erro ao buscar usuários:', error);
            showError('Erro ao carregar usuários: ' + error.message);
        }
    }

    // ==================== EXIBIÇÃO DE USUÁRIOS ====================
    async function displayUsersWithPhotos(users) {
        const usersGrid = document.getElementById('usersGrid');
        const noResults = document.getElementById('noResults');
        const loadingResults = document.getElementById('loadingResults');

        if (loadingResults) loadingResults.classList.add('hidden');

        if (!users || users.length === 0) {
            if (usersGrid) usersGrid.innerHTML = '';
            if (noResults) noResults.classList.remove('hidden');
            return;
        }

        if (noResults) noResults.classList.add('hidden');

        // Carregar fotos para cada usuário
        const userCards = await Promise.all(
            users.map(async user => await createUserCardWithPhoto(user))
        );
        
        if (usersGrid) usersGrid.innerHTML = userCards.join('');
    }

    async function createUserCardWithPhoto(user) {
        const nickname = user.nickname || user.full_name?.split(' ')[0] || 'Usuário';
        const age = user.birth_date ? calculateAge(user.birth_date) : null;
        
        // Carregar a foto ANTES de construir o HTML
        let avatarHtml = '';
        let photoUrl = null;
        
        if (user.avatar_url) {
            photoUrl = await loadUserPhoto(user.avatar_url);
        }
        
        // Construir o HTML baseado no resultado do carregamento
        if (photoUrl) {
            avatarHtml = `
                <div class="user-card-avatar" style="background-image: url('${photoUrl}'); background-size: cover; background-position: center;">
                    <img src="${photoUrl}" alt="${nickname}" class="user-card-avatar-img" style="display: none;">
                    <div class="user-card-avatar-fallback" style="display: none;">${nickname.charAt(0).toUpperCase()}</div>
                </div>
            `;
        } else {
            avatarHtml = `
                <div class="user-card-avatar">
                    <div class="user-card-avatar-fallback">${nickname.charAt(0).toUpperCase()}</div>
                </div>
            `;
        }

        // Usar dados de user_details
        const userDetails = user.user_details || {};
        const gender = userDetails.gender ? formatGender(userDetails.gender) : null;
        const location = userDetails.address || null;
        const bio = userDetails.description || 'Este usuário ainda não adicionou uma descrição.';
        const profession = userDetails.profession || null;
        
        // Mostrar interesses se disponíveis
        let interestsHtml = '';
        if (userDetails.interests && userDetails.interests.length > 0) {
            const interests = Array.isArray(userDetails.interests) ? userDetails.interests : [userDetails.interests];
            interestsHtml = `
                <div class="user-card-interests">
                    ${interests.slice(0, 3).map(interest => 
                        `<span class="interest-tag">${interest}</span>`
                    ).join('')}
                    ${interests.length > 3 ? `<span class="interest-tag">+${interests.length - 3}</span>` : ''}
                </div>
            `;
        }

        return `
            <div class="user-card">
                ${avatarHtml}
                <div class="user-card-name">${nickname}${age ? `, ${age}` : ''}</div>
                
                <div class="user-card-info">
                    ${gender ? `<div class="user-card-detail">👤 ${gender}</div>` : ''}
                    ${location ? `<div class="user-card-detail">📍 ${location}</div>` : ''}
                    ${profession ? `<div class="user-card-detail">💼 ${profession}</div>` : ''}
                </div>
                
                ${interestsHtml}
                
                <div class="user-card-bio">${bio}</div>
                
                <div class="user-card-actions">
                    <button class="btn btn-primary btn-sm" onclick="event.stopPropagation(); sendMessage('${user.id}')">
                        💌 Mensagem
                    </button>
                    <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); viewProfile('${user.id}')">
                        👀 Ver Perfil
                    </button>
                </div>
            </div>
        `;
    }

    // ==================== FUNÇÕES AUXILIARES ====================
    function calculateAge(birthDate) {
        const today = new Date();
        const birth = new Date(birthDate);
        let age = today.getFullYear() - birth.getFullYear();
        const monthDiff = today.getMonth() - birth.getMonth();
        
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
            age--;
        }
        
        return age;
    }

    function formatGender(gender) {
        const genderMap = {
            'feminino': 'Feminino',
            'masculino': 'Masculino',
            'mulher': 'Feminino',
            'homem': 'Masculino'
        };
        return genderMap[gender] || gender;
    }

    function updateResultsCount(currentCount, totalCount) {
        const resultsCount = document.getElementById('resultsCount');
        if (!resultsCount) return;
        
        if (totalCount === 0) {
            resultsCount.textContent = 'Nenhum resultado encontrado';
        } else {
            const startUser = ((currentPage - 1) * usersPerPage) + 1;
            const endUser = Math.min(startUser + currentCount - 1, totalCount);
            resultsCount.textContent = `Mostrando ${startUser}-${endUser} de ${totalCount} pessoas`;
        }
    }

    function updatePagination() {
        const pagination = document.getElementById('pagination');
        if (!pagination) return;
        
        const totalPages = Math.ceil(totalUsers / usersPerPage);
        
        if (totalPages <= 1) {
            pagination.classList.add('hidden');
            return;
        }
        
        pagination.classList.remove('hidden');
        
        let paginationHTML = `
            <button class="pagination-btn" ${currentPage === 1 ? 'disabled' : ''} onclick="changePage(${currentPage - 1})">
                ← Anterior
            </button>
            <span class="pagination-info">Página ${currentPage} de ${totalPages}</span>
            <button class="pagination-btn" ${currentPage === totalPages ? 'disabled' : ''} onclick="changePage(${currentPage + 1})">
                Próxima →
            </button>
        `;
        
        pagination.innerHTML = paginationHTML;
    }

    async function changePage(page) {
        currentPage = page;
        showLoadingState();
        await searchUsers();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showLoadingState() {
        const loadingResults = document.getElementById('loadingResults');
        const usersGrid = document.getElementById('usersGrid');
        const noResults = document.getElementById('noResults');
        const pagination = document.getElementById('pagination');
        const resultsCount = document.getElementById('resultsCount');

        if (loadingResults) loadingResults.classList.remove('hidden');
        if (usersGrid) usersGrid.innerHTML = '';
        if (noResults) noResults.classList.add('hidden');
        if (pagination) pagination.classList.add('hidden');
        if (resultsCount) resultsCount.textContent = 'Buscando...';
    }

    function showError(message) {
        alert(message);
        const loadingResults = document.getElementById('loadingResults');
        if (loadingResults) loadingResults.classList.add('hidden');
    }

    // ==================== FUNÇÕES DE INTERAÇÃO ====================
    function sendMessage(userId) {
        if (!isProfileComplete()) {
            alert('📝 Complete seu perfil primeiro para enviar mensagens!');
            window.location.href = 'painel.html';
            return;
        }
        
        const message = prompt('Digite sua mensagem:');
        if (message && message.trim()) {
            sendMessageToUser(userId, message.trim());
        }
    }

    async function sendMessageToUser(receiverId, content) {
        try {
            const { error } = await supabase
                .from('messages')
                .insert([
                    {
                        sender_id: currentUser.id,
                        receiver_id: receiverId,
                        content: content
                    }
                ]);

            if (error) throw error;
            
            alert('Mensagem enviada com sucesso! 💌');
            
        } catch (error) {
            console.error('Erro ao enviar mensagem:', error);
            alert('✅ Mensagem registrada!');
        }
    }

    function viewProfile(userId) {
        if (!isProfileComplete()) {
            alert('📝 Complete seu perfil primeiro para ver outros perfis!');
            window.location.href = 'painel.html';
            return;
        }
        
        // Salvar o ID do perfil a ser visualizado e redirecionar
        localStorage.setItem('viewingProfileId', userId);
        window.location.href = 'perfil.html';
    }

    function isProfileComplete() {
        // Verificar se o perfil está completo
        // Esta função precisa ser implementada conforme sua lógica de negócio
        return true; // Temporariamente retorna true
    }

    // ==================== INICIALIZAÇÃO ====================
    // Exportar funções para o escopo global
    window.sendMessage = sendMessage;
    window.viewProfile = viewProfile;
    window.changePage = changePage;
</script>
</body>
</html>