<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscar Pessoas - Amor Conect</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --bege: #f6ecc5;
            --vermelho-rosado: #d1656d;
            --lilas: #dfc9ed;
            --branco: #ffffff;
            --text: #444;
            --text-light: #666;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        body {
            background-color: var(--bege);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--vermelho-rosado), var(--lilas));
            color: var(--branco);
            padding: 0.5rem 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .logo img {
            height: 120px;
            width: auto;
            object-fit: contain;
        }

        .logo h1 {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--branco);
            white-space: nowrap;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--branco);
            color: var(--vermelho-rosado);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.4rem;
            background-size: cover;
            background-position: center;
            border: 2px solid var(--branco);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .btn {
            padding: 0.4rem 1.2rem;
            border-radius: 30px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-block;
            text-align: center;
            font-size: 0.85rem;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--branco);
            color: var(--branco);
        }

        .btn-primary {
            background: var(--branco);
            color: var(--vermelho-rosado);
            border: none;
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--vermelho-rosado);
            color: var(--vermelho-rosado);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* Main Content */
        .main-content {
            padding: 2rem 0;
            min-height: 70vh;
        }

        /* Page Header */
        .page-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--branco);
            border-radius: 15px;
            box-shadow: var(--shadow);
            border: 1px solid var(--lilas);
        }

        .page-header h1 {
            font-size: 2rem;
            color: var(--vermelho-rosado);
            margin-bottom: 0.5rem;
        }

        .page-header p {
            color: var(--text-light);
            font-size: 1rem;
        }

        /* Filters Section */
        .filters-section {
            margin-bottom: 2rem;
        }

        .filters-card {
            background: var(--branco);
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: var(--shadow);
            border: 1px solid var(--lilas);
        }

        .filters-card h3 {
            font-size: 1.3rem;
            color: var(--vermelho-rosado);
            margin-bottom: 1.5rem;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-group label {
            font-weight: 600;
            color: var(--text);
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--lilas);
            border-radius: 10px;
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--bege);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--vermelho-rosado);
            background-color: var(--branco);
        }

        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
        }

        select.form-control[multiple] {
            background-image: none;
            height: auto;
            min-height: 120px;
            padding: 0.5rem;
        }

        select.form-control[multiple] option {
            padding: 0.5rem;
            border-radius: 5px;
            margin: 2px 0;
        }

        select.form-control[multiple] option:hover {
            background-color: var(--lilas);
        }

        select.form-control[multiple] option:checked {
            background-color: var(--vermelho-rosado);
            color: white;
        }

        .range-inputs {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .range-inputs input {
            flex: 1;
            text-align: center;
        }

        .range-inputs span {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .filter-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Results Section */
        .results-section {
            background: var(--branco);
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: var(--shadow);
            border: 1px solid var(--lilas);
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--bege);
        }

        .results-header h2 {
            font-size: 1.5rem;
            color: var(--vermelho-rosado);
            margin: 0;
        }

        .results-info {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        /* Users Grid */
        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .user-card {
            background: var(--bege);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .user-card:hover {
            transform: translateY(-5px);
            border-color: var(--lilas);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        /* AVATAR NAS CARDS */
        .user-card-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--vermelho-rosado), var(--lilas));
            color: var(--branco);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            margin: 0 auto 1rem;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border: 3px solid var(--branco);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        .user-card-avatar-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            display: none;
        }

        .user-card-avatar-fallback {
            font-size: 2rem;
            font-weight: bold;
        }

        .user-card-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 0.5rem;
        }

        .user-card-info {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
            margin-bottom: 1rem;
        }

        .user-card-detail {
            font-size: 0.9rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.3rem;
        }

        .user-card-interests {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .interest-tag {
            background: var(--lilas);
            color: var(--text);
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .user-card-bio {
            font-size: 0.9rem;
            color: var(--text);
            margin-bottom: 1.5rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 4.5rem;
            line-height: 1.4;
        }

        .user-card-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 3rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--bege);
            border-top: 4px solid var(--vermelho-rosado);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* No Results */
        .no-results {
            text-align: center;
            padding: 3rem 2rem;
        }

        .no-results.hidden {
            display: none;
        }

        .no-results-content {
            max-width: 400px;
            margin: 0 auto;
        }

        .no-results-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.7;
        }

        .no-results h3 {
            font-size: 1.3rem;
            color: var(--vermelho-rosado);
            margin-bottom: 1rem;
        }

        .no-results p {
            color: var(--text-light);
            line-height: 1.6;
            font-size: 0.9rem;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 2rem;
        }

        .pagination-btn {
            padding: 0.5rem 1rem;
            border: 2px solid var(--vermelho-rosado);
            background: var(--branco);
            color: var(--vermelho-rosado);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .pagination-btn:hover:not(:disabled) {
            background: var(--vermelho-rosado);
            color: var(--branco);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-info {
            color: var(--text-light);
            font-size: 0.9rem;
            margin: 0 1rem;
        }

        /* Footer */
        footer {
            background-color: var(--bege);
            color: var(--text);
            padding: 2rem 0 1rem;
            margin-top: 2rem;
            border-top: 1px solid var(--lilas);
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .footer-column h3 {
            margin-bottom: 1rem;
            font-size: 1.1rem;
            color: var(--vermelho-rosado);
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column ul li {
            margin-bottom: 0.5rem;
        }

        .footer-column a {
            color: var(--text);
            text-decoration: none;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .footer-column a:hover {
            color: var(--vermelho-rosado);
        }

        .copyright {
            text-align: center;
            padding-top: 1rem;
            border-top: 1px solid var(--lilas);
            font-size: 0.8rem;
            color: var(--text-light);
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 0.8rem;
                height: auto;
                padding: 0.5rem 0;
            }

            .user-menu {
                flex-direction: column;
                gap: 0.8rem;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .filter-actions {
                flex-direction: column;
            }

            .users-grid {
                grid-template-columns: 1fr;
            }

            .results-header {
                flex-direction: column;
                gap: 0.5rem;
                align-items: flex-start;
            }

            .page-header h1 {
                font-size: 1.8rem;
            }

            .logo img {
                height: 100px;
            }

            .logo h1 {
                font-size: 1.2rem;
            }

            .user-avatar {
                width: 45px;
                height: 45px;
                font-size: 1.2rem;
            }

            .user-card-avatar {
                width: 70px;
                height: 70px;
                font-size: 1.8rem;
            }
        }

        @media (max-width: 480px) {
            .user-card-actions {
                flex-direction: column;
            }

            .logo img {
                height: 90px;
            }

            .logo h1 {
                font-size: 1.1rem;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="logoamorconect.png" alt="Amor Conect">
                    <h1>Amor Conect</h1>
                </div>
                <div class="user-menu">
                    <div class="user-info">
                        <div class="user-avatar" id="userAvatar">
                            <img class="user-avatar-img" src="" alt="Avatar" style="display: none;">
                            <div class="user-avatar-fallback">U</div>
                        </div>
                        <span id="userNickname">Usuário</span>
                    </div>
                    <a href="mensagens.html" class="btn btn-outline">💌 Mensagens</a>
                    <a href="home.html" class="btn btn-outline">🏠 Home</a>
                    <button class="btn btn-outline" id="logoutBtn">🚪 Sair</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Page Header -->
            <section class="page-header">
                <h1>🔍 Buscar Pessoas</h1>
                <p>Encontre pessoas incríveis com interesses similares aos seus</p>
            </section>

            <!-- Search Filters -->
            <section class="filters-section">
                <div class="filters-card">
                    <h3>Filtros de Busca</h3>
                    
                    <div class="filters-grid">
                        <!-- Idade -->
                        <div class="filter-group">
                            <label for="ageMin">Idade</label>
                            <div class="range-inputs">
                                <input type="number" id="ageMin" placeholder="18" min="18" max="100">
                                <span>até</span>
                                <input type="number" id="ageMax" placeholder="60" min="18" max="100">
                            </div>
                        </div>

                        <!-- Gênero -->
                        <div class="filter-group">
                            <label for="gender">Gênero</label>
                            <select id="gender" class="form-control">
                                <option value="">Todos</option>
                                <option value="feminino">Feminino</option>
                                <option value="masculino">Masculino</option>
                            </select>
                        </div>

                        <!-- Interesses -->
                        <div class="filter-group">
                            <label for="interests">Interesses</label>
                            <select id="interests" class="form-control" multiple>
                                <option value="nao_importa">💫 Não importa</option>
                                <option value="Cinema">🎬 Cinema</option>
                                <option value="Música">🎵 Música</option>
                                <option value="Esportes">⚽ Esportes</option>
                                <option value="Viagens">✈️ Viagens</option>
                                <option value="Leitura">📚 Leitura</option>
                                <option value="Culinária">🍳 Culinária</option>
                                <option value="Jogos">🎮 Jogos</option>
                                <option value="Arte">🎨 Arte</option>
                            </select>
                        </div>

                        <!-- Procura por -->
                        <div class="filter-group">
                            <label for="lookingFor">Procura por</label>
                            <select id="lookingFor" class="form-control">
                                <option value="">Todos</option>
                                <option value="amizade">🤝 Amizade</option>
                                <option value="namoro">💕 Namoro</option>
                                <option value="relacionamento_serio">💍 Relacionamento Sério</option>
                                <option value="conversa">💬 Apenas Conversa</option>
                            </select>
                        </div>

                        <!-- Localização -->
                        <div class="filter-group">
                            <label for="location">📍 Localização</label>
                            <input type="text" id="location" class="form-control" placeholder="Cidade ou Estado">
                        </div>

                        <!-- Signo -->
                        <div class="filter-group">
                            <label for="zodiac">⭐ Signo</label>
                            <select id="zodiac" class="form-control">
                                <option value="">Todos</option>
                                <option value="aries">♈ Áries</option>
                                <option value="touro">♉ Touro</option>
                                <option value="gemeos">♊ Gêmeos</option>
                                <option value="cancer">♋ Câncer</option>
                                <option value="leao">♌ Leão</option>
                                <option value="virgem">♍ Virgem</option>
                                <option value="libra">♎ Libra</option>
                                <option value="escorpiao">♏ Escorpião</option>
                                <option value="sagitario">♐ Sagitário</option>
                                <option value="capricornio">♑ Capricórnio</option>
                                <option value="aquario">♒ Aquário</option>
                                <option value="peixes">♓ Peixes</option>
                            </select>
                        </div>
                    </div>

                    <div class="filter-actions">
                        <button class="btn btn-primary" id="applyFiltersBtn">
                            🔍 Aplicar Filtros
                        </button>
                        <button class="btn btn-secondary" id="clearFiltersBtn">
                            🗑️ Limpar Filtros
                        </button>
                    </div>
                </div>
            </section>

            <!-- Results Section -->
            <section class="results-section">
                <div class="results-header">
                    <h2>Pessoas Encontradas</h2>
                    <div class="results-info">
                        <span id="resultsCount">Carregando...</span>
                    </div>
                </div>

                <!-- Loading State -->
                <div class="loading hidden" id="loadingResults">
                    <div class="spinner"></div>
                    <p>Buscando pessoas...</p>
                </div>

                <!-- Results Grid -->
                <div class="users-grid" id="usersGrid">
                    <!-- Os cards serão inseridos aqui via JavaScript -->
                </div>

                <!-- Pagination -->
                <div class="pagination hidden" id="pagination">
                    <!-- Paginação será inserida aqui -->
                </div>

                <!-- No Results -->
                <div class="no-results hidden" id="noResults">
                    <div class="no-results-content">
                        <div class="no-results-icon">🔍</div>
                        <h3>Nenhuma pessoa encontrada</h3>
                        <p>Tente ajustar os filtros de busca para encontrar mais pessoas.</p>
                        <button class="btn btn-primary" id="clearFiltersNoResults">
                            🗑️ Limpar Filtros
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Amor Conect</h3>
                    <p>Uma plataforma segura e discreta para conectar corações e construir relacionamentos genuínos.</p>
                </div>
                <div class="footer-column">
                    <h3>Links Rápidos</h3>
                    <ul>
                        <li><a href="index.html">Página Inicial</a></li>
                        <li><a href="home.html">Home</a></li>
                        <li><a href="mensagens.html">Mensagens</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Suporte</h3>
                    <ul>
                        <li><a href="#">Central de Ajuda</a></li>
                        <li><a href="#">Política de Privacidade</a></li>
                        <li><a href="#">Termos de Uso</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 Amor Conect. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>
        <script>
        // Configuração do Supabase
        const SUPABASE_URL = 'https://gcukalndarlgydmgmmmt.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdjdWthbG5kYXJsZ3lkbWdtbW10Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2NzI1ODEsImV4cCI6MjA3NTI0ODU4MX0.S1Qt1UbmK-Jtq2dX7Aarf2rDLZhoLgEcSLkCrBfIhUU';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Estado da aplicação
        let currentUser = null;
        let currentPage = 1;
        const usersPerPage = 12;
        let totalUsers = 0;
        let currentFilters = {};

        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
        });

        // Verificar autenticação
        async function checkAuth() {
            try {
                const { data: { user }, error } = await supabase.auth.getUser();
                
                if (error) throw error;
                
                if (!user) {
                    window.location.href = 'login.html';
                    return;
                }
                
                currentUser = user;
                await loadUserData();
                setupEventListeners();
                await loadInitialUsers();
                
            } catch (error) {
                console.error('Erro na autenticação:', error);
                window.location.href = 'login.html';
            }
        }

        // Carregar dados do usuário
        async function loadUserData() {
            try {
                const { data: { user } } = await supabase.auth.getUser();
                
                let displayName = 'Usuário';
                
                if (user.user_metadata && user.user_metadata.nickname) {
                    displayName = user.user_metadata.nickname;
                } else if (user.user_metadata && user.user_metadata.full_name) {
                    displayName = user.user_metadata.full_name;
                } else if (user.email) {
                    displayName = user.email.split('@')[0];
                }

                document.getElementById('userNickname').textContent = displayName;
                
                // Carregar foto do usuário logado
                await loadCurrentUserAvatar();

            } catch (error) {
                console.error('Erro ao carregar dados do usuário:', error);
            }
        }

        // Carregar foto do usuário logado
        async function loadCurrentUserAvatar() {
            try {
                const { data: profile, error } = await supabase
                    .from('profiles')
                    .select('avatar_url, nickname')
                    .eq('id', currentUser.id)
                    .single();

                if (error || !profile) return;

                const userAvatar = document.getElementById('userAvatar');
                const userAvatarFallback = userAvatar.querySelector('.user-avatar-fallback');
                const userAvatarImg = userAvatar.querySelector('.user-avatar-img');
                
                if (profile.avatar_url) {
                    const photoUrl = await loadUserPhoto(profile.avatar_url);
                    if (photoUrl) {
                        userAvatarImg.src = photoUrl;
                        userAvatarImg.style.display = 'block';
                        userAvatarFallback.style.display = 'none';
                    }
                }

            } catch (error) {
                console.error('Erro ao carregar avatar do usuário:', error);
            }
        }

        // Carregar foto do usuário
        async function loadUserPhoto(avatarUrl) {
            try {
                if (!avatarUrl) return null;

                const { data, error } = await supabase.storage
                    .from('avatars')
                    .download(avatarUrl);

                if (error) return null;

                return URL.createObjectURL(data);

            } catch (error) {
                console.error('Erro ao carregar foto:', error);
                return null;
            }
        }

        // Configurar event listeners
        function setupEventListeners() {
            document.getElementById('logoutBtn').addEventListener('click', logout);
            document.getElementById('applyFiltersBtn').addEventListener('click', applyFilters);
            document.getElementById('clearFiltersBtn').addEventListener('click', clearFilters);
            document.getElementById('clearFiltersNoResults').addEventListener('click', clearFilters);
        }

        // Fazer logout
        async function logout() {
            try {
                const { error } = await supabase.auth.signOut();
                if (error) throw error;
                window.location.href = 'login.html';
            } catch (error) {
                console.error('Erro ao fazer logout:', error);
            }
        }

        // Carregar usuários iniciais
        async function loadInitialUsers() {
            await applyFilters();
        }

        // Aplicar filtros
        async function applyFilters() {
            try {
                currentPage = 1;
                currentFilters = getCurrentFilters();
                
                showLoadingState();
                await searchUsers();
                
            } catch (error) {
                console.error('Erro ao aplicar filtros:', error);
                showError('Erro ao buscar usuários. Tente novamente.');
            }
        }

        // Limpar filtros
        function clearFilters() {
            document.getElementById('ageMin').value = '';
            document.getElementById('ageMax').value = '';
            document.getElementById('gender').value = '';
            document.getElementById('lookingFor').value = '';
            document.getElementById('location').value = '';
            document.getElementById('zodiac').value = '';
            
            // Limpar seleção múltipla de interesses
            const interestsSelect = document.getElementById('interests');
            for (let option of interestsSelect.options) {
                option.selected = false;
            }
            
            applyFilters();
        }

        // Obter filtros atuais
        function getCurrentFilters() {
            const ageMin = document.getElementById('ageMin').value;
            const ageMax = document.getElementById('ageMax').value;
            const gender = document.getElementById('gender').value;
            const lookingFor = document.getElementById('lookingFor').value;
            const location = document.getElementById('location').value;
            const zodiac = document.getElementById('zodiac').value;
            
            // Obter interesses selecionados
            const interestsSelect = document.getElementById('interests');
            const selectedInterests = [];
            for (let option of interestsSelect.options) {
                if (option.selected) {
                    if (option.value === 'nao_importa') {
                        return {
                            ageMin: ageMin ? parseInt(ageMin) : null,
                            ageMax: ageMax ? parseInt(ageMax) : null,
                            gender: gender || null,
                            lookingFor: lookingFor || null,
                            location: location || null,
                            zodiac: zodiac || null,
                            interests: null
                        };
                    }
                    selectedInterests.push(option.value);
                }
            }

            return {
                ageMin: ageMin ? parseInt(ageMin) : null,
                ageMax: ageMax ? parseInt(ageMax) : null,
                gender: gender || null,
                lookingFor: lookingFor || null,
                location: location || null,
                zodiac: zodiac || null,
                interests: selectedInterests.length > 0 ? selectedInterests : null
            };
        }

        // Buscar usuários
        async function searchUsers() {
            try {
                console.log('🔍 Aplicando filtros:', currentFilters);
                
                let query = supabase
                    .from('profiles')
                    .select('*')
                    .neq('id', currentUser.id)
                    .not('birth_date', 'is', null);

                const { data: users, error } = await query;

                if (error) throw error;

                console.log('📊 Usuários encontrados:', users?.length);

                // Aplicar filtros no client-side
                let filteredUsers = users || [];
                
                // Filtro de idade
                if (currentFilters.ageMin || currentFilters.ageMax) {
                    filteredUsers = filteredUsers.filter(user => {
                        if (!user.birth_date) return false;
                        
                        const age = calculateAge(user.birth_date);
                        const minAge = currentFilters.ageMin || 0;
                        const maxAge = currentFilters.ageMax || 100;
                        
                        return age >= minAge && age <= maxAge;
                    });
                }

                // Filtro de gênero
                if (currentFilters.gender) {
                    filteredUsers = filteredUsers.filter(user => 
                        user.gender === currentFilters.gender
                    );
                }

                // Filtro de localização
                if (currentFilters.location) {
                    filteredUsers = filteredUsers.filter(user => 
                        user.city && user.city.toLowerCase().includes(currentFilters.location.toLowerCase())
                    );
                }

                console.log('🎉 RESULTADO FINAL:', filteredUsers.length, 'usuários');

                // Paginação
                totalUsers = filteredUsers.length;
                const startIndex = (currentPage - 1) * usersPerPage;
                const endIndex = startIndex + usersPerPage;
                const paginatedUsers = filteredUsers.slice(startIndex, endIndex);

                await displayUsersWithPhotos(paginatedUsers);
                updatePagination();
                updateResultsCount(paginatedUsers.length, totalUsers);

            } catch (error) {
                console.error('❌ Erro ao buscar usuários:', error);
                showError('Erro ao carregar usuários: ' + error.message);
            }
        }

        // Exibir usuários com fotos
        async function displayUsersWithPhotos(users) {
            const usersGrid = document.getElementById('usersGrid');
            const noResults = document.getElementById('noResults');
            const loadingResults = document.getElementById('loadingResults');

            loadingResults.classList.add('hidden');

            if (!users || users.length === 0) {
                usersGrid.innerHTML = '';
                noResults.classList.remove('hidden');
                return;
            }

            noResults.classList.add('hidden');

            // Carregar fotos para cada usuário
            const userCards = await Promise.all(
                users.map(async user => await createUserCardWithPhoto(user))
            );
            
            usersGrid.innerHTML = userCards.join('');
        }

        // Criar card de usuário com foto
        async function createUserCardWithPhoto(user) {
            const nickname = user.nickname || user.full_name?.split(' ')[0] || 'Usuário';
            const age = user.birth_date ? calculateAge(user.birth_date) : null;
            
            // Carregar foto do usuário
            let avatarHtml = '';
            if (user.avatar_url) {
                const photoUrl = await loadUserPhoto(user.avatar_url);
                if (photoUrl) {
                    avatarHtml = `
                        <div class="user-card-avatar" style="background: none;">
                            <img src="${photoUrl}" alt="${nickname}" class="user-card-avatar-img" style="display: block;">
                            <div class="user-card-avatar-fallback" style="display: none;">${nickname.charAt(0).toUpperCase()}</div>
                        </div>
                    `;
                } else {
                    avatarHtml = `
                        <div class="user-card-avatar">
                            <div class="user-card-avatar-fallback">${nickname.charAt(0).toUpperCase()}</div>
                        </div>
                    `;
                }
            } else {
                avatarHtml = `
                    <div class="user-card-avatar">
                        <div class="user-card-avatar-fallback">${nickname.charAt(0).toUpperCase()}</div>
                    </div>
                `;
            }

            const gender = user.gender ? formatGender(user.gender) : null;
            const location = user.city || null;
            const bio = user.bio || 'Este usuário ainda não adicionou uma descrição.';

            return `
                <div class="user-card">
                    ${avatarHtml}
                    <div class="user-card-name">${nickname}${age ? `, ${age}` : ''}</div>
                    
                    <div class="user-card-info">
                        ${gender ? `<div class="user-card-detail">👤 ${gender}</div>` : ''}
                        ${location ? `<div class="user-card-detail">📍 ${location}</div>` : ''}
                    </div>
                    
                    <div class="user-card-bio">${bio}</div>
                    
                    <div class="user-card-actions">
                        <button class="btn btn-primary btn-sm" onclick="event.stopPropagation(); sendMessage('${user.id}')">
                            💌 Mensagem
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); viewProfile('${user.id}')">
                            👀 Ver Perfil
                        </button>
                    </div>
                </div>
            `;
        }

        // Calcular idade a partir da data de nascimento
        function calculateAge(birthDate) {
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            
            return age;
        }

        // Formatar gênero para exibição
        function formatGender(gender) {
            const genderMap = {
                'feminino': 'Feminino',
                'masculino': 'Masculino'
            };
            return genderMap[gender] || gender;
        }

        // Atualizar contagem de resultados
        function updateResultsCount(currentCount, totalCount) {
            const resultsCount = document.getElementById('resultsCount');
            if (totalCount === 0) {
                resultsCount.textContent = 'Nenhum resultado encontrado';
            } else {
                resultsCount.textContent = `Mostrando ${currentCount} de ${totalCount} pessoas`;
            }
        }

        // Atualizar paginação
        function updatePagination() {
            const pagination = document.getElementById('pagination');
            const totalPages = Math.ceil(totalUsers / usersPerPage);
            
            if (totalPages <= 1) {
                pagination.classList.add('hidden');
                return;
            }
            
            pagination.classList.remove('hidden');
            
            let paginationHTML = `
                <button class="pagination-btn" ${currentPage === 1 ? 'disabled' : ''} onclick="changePage(${currentPage - 1})">
                    ← Anterior
                </button>
                <span class="pagination-info">Página ${currentPage} de ${totalPages}</span>
                <button class="pagination-btn" ${currentPage === totalPages ? 'disabled' : ''} onclick="changePage(${currentPage + 1})">
                    Próxima →
                </button>
            `;
            
            pagination.innerHTML = paginationHTML;
        }

        // Mudar página
        async function changePage(page) {
            currentPage = page;
            showLoadingState();
            await searchUsers();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Mostrar estado de carregamento
        function showLoadingState() {
            document.getElementById('loadingResults').classList.remove('hidden');
            document.getElementById('usersGrid').innerHTML = '';
            document.getElementById('noResults').classList.add('hidden');
            document.getElementById('pagination').classList.add('hidden');
        }

        // Mostrar erro
        function showError(message) {
            alert(message);
            document.getElementById('loadingResults').classList.add('hidden');
        }

        // Enviar mensagem (placeholder)
        function sendMessage(userId) {
            alert(`Função de enviar mensagem para o usuário ${userId} será implementada em breve!`);
            // window.location.href = `mensagens.html?user=${userId}`;
        }

        // Ver perfil (placeholder)
        function viewProfile(userId) {
            alert(`Função de ver perfil do usuário ${userId} será implementada em breve!`);
            // window.location.href = `perfil.html?id=${userId}`;
        }
    </script>
</body>
</html>