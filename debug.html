<!DOCTYPE html>
<html>
<head>
    <title>Debug Supabase</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>üîß Debug Conex√£o Perfeita</h1>
    <div id="debug-info" style="padding: 20px; background: #f5f5f5; border-radius: 10px;"></div>
    
    <script>
        const SUPABASE_URL = 'https://gcukalndarlgydmgmmmt.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdjdWthbG5kYXJsZ3lkbWdtbW10Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2NzI1ODEsImV4cCI6MjA3NTI0ODU4MX0.S1Qt1UbmK-Jtq2dX7Aarf2rDLZhoLgEcSLkCrBfIhUU';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const debug = document.getElementById('debug-info');

        async function runDiagnostics() {
            let html = '<h2>üìä Diagn√≥stico do Sistema</h2>';
            
            // 1. Testar conex√£o b√°sica
            html += '<h3>1. üîå Teste de Conex√£o:</h3>';
            try {
                const { data, error } = await supabase.from('profiles').select('count').limit(1);
                if (error) throw error;
                html += '<p style="color: green;">‚úÖ Conex√£o com Supabase: OK</p>';
            } catch (error) {
                html += `<p style="color: red;">‚ùå Erro na conex√£o: ${error.message}</p>`;
            }

            // 2. Testar configura√ß√£o de Auth
            html += '<h3>2. üîê Teste de Autentica√ß√£o:</h3>';
            try {
                const { data: { user }, error } = await supabase.auth.getUser();
                if (error) throw error;
                html += `<p>‚úÖ Auth configurado - Usu√°rio: ${user ? 'Logado' : 'Deslogado'}</p>`;
            } catch (error) {
                html += `<p style="color: red;">‚ùå Erro no Auth: ${error.message}</p>`;
            }

            // 3. Verificar configura√ß√£o de URLs
            html += '<h3>3. üåê Configura√ß√£o de URLs:</h3>';
            html += `<p>üìß Email Redirect To: https://conexaoperfeitaamor.netlify.app/login.html?verified=true</p>`;
            html += `<p>üîó Site URL atual: ${window.location.href}</p>`;

            // 4. Verificar tabelas
            html += '<h3>4. üóÉÔ∏è Verifica√ß√£o de Tabelas:</h3>';
            const tables = ['profiles', 'user_details', 'messages'];
            
            for (let table of tables) {
                try {
                    const { data, error } = await supabase.from(table).select('*').limit(1);
                    if (error && error.code === '42P01') {
                        html += `<p style="color: orange;">‚ö†Ô∏è Tabela "${table}": N√ÉO EXISTE</p>`;
                    } else if (error) {
                        html += `<p style="color: red;">‚ùå Erro na tabela "${table}": ${error.message}</p>`;
                    } else {
                        html += `<p style="color: green;">‚úÖ Tabela "${table}": OK</p>`;
                    }
                } catch (error) {
                    html += `<p style="color: red;">‚ùå Erro verifica√ß√£o "${table}": ${error.message}</p>`;
                }
            }

            debug.innerHTML = html;
        }

        runDiagnostics();
    </script>
</body>
</html>